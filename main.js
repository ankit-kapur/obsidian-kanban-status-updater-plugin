'use strict';

var obsidian = require('obsidian');

/******************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */

function __awaiter(thisArg, _arguments, P, generator) {
    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }
    return new (P || (P = Promise))(function (resolve, reject) {
        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }
        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }
        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
    });
}

typeof SuppressedError === "function" ? SuppressedError : function (error, suppressed, message) {
    var e = new Error(message);
    return e.name = "SuppressedError", e.error = error, e.suppressed = suppressed, e;
};

const DEFAULT_SETTINGS = {
    statusPropertyName: 'status',
    showNotifications: true,
    debugMode: true
};
class KanbanStatusUpdaterPlugin extends obsidian.Plugin {
    constructor() {
        super(...arguments);
        // Process flags to avoid infinite loops
        this.processingMutation = false;
        this.pendingCardUpdates = new Map();
        this.mutationDebounceTimeout = null;
    }
    onload() {
        return __awaiter(this, void 0, void 0, function* () {
            yield this.loadSettings();
            // Set up debug logging with rate limiting
            let lastLogTime = Date.now();
            let logCount = 0;
            this.debugLog = (message) => {
                if (this.settings.debugMode) {
                    // Rate limit logs to prevent console flooding
                    const now = Date.now();
                    if (now - lastLogTime > 5000) {
                        // Reset counter after 5 seconds
                        logCount = 0;
                        lastLogTime = now;
                    }
                    if (logCount < 50) { // Limit to 50 logs per 5 seconds
                        console.log(`[Kanban Status Updater] ${message}`);
                        logCount++;
                        if (this.statusBarItem) {
                            this.statusBarItem.setText(`[KSU] ${message.substring(0, 40)}${message.length > 40 ? '...' : ''}`);
                            // Reset after 5 seconds
                            setTimeout(() => {
                                if (this.statusBarItem) {
                                    this.statusBarItem.setText('Kanban Status Updater Active');
                                }
                            }, 5000);
                        }
                    }
                    else if (logCount === 50) {
                        console.log(`[Kanban Status Updater] Too many logs, throttling until ${new Date(lastLogTime + 5000).toLocaleTimeString()}`);
                        logCount++;
                    }
                }
            };
            // Display startup notification
            new obsidian.Notice('Kanban Status Updater plugin activated');
            this.debugLog('Plugin loaded and activated');
            // Hook into DOM events to detect Kanban card movements
            this.registerDomEvent(document, 'dragend', this.handleDragEnd.bind(this));
            this.debugLog('Registered drag event listener');
            // Register for mutation events to catch non-drag updates - with optimizations
            const observer = new MutationObserver((mutations) => {
                // Skip processing if we're already handling a mutation
                if (this.processingMutation)
                    return;
                // Debounce mutation processing to avoid too many updates
                if (this.mutationDebounceTimeout) {
                    clearTimeout(this.mutationDebounceTimeout);
                }
                this.mutationDebounceTimeout = setTimeout(() => {
                    this.handleDOMMutations(mutations);
                    this.mutationDebounceTimeout = null;
                }, 500); // Wait 500ms before processing
            });
            this.app.workspace.onLayoutReady(() => {
                // Find Kanban board containers to observe more specifically
                const kanbanBoards = document.querySelectorAll('.kanban-plugin__board, .kanban-board');
                if (kanbanBoards && kanbanBoards.length > 0) {
                    // Observe each Kanban board specifically rather than the entire document
                    kanbanBoards.forEach(board => {
                        observer.observe(board, {
                            childList: true,
                            subtree: true,
                            attributes: false // Don't need attribute changes, just structure
                        });
                    });
                    this.debugLog(`MutationObserver attached to ${kanbanBoards.length} Kanban boards`);
                }
                else {
                    // Look for elements with kanban-plugin__ in their class names
                    const kanbanElements = document.querySelectorAll('[class*="kanban-plugin__"]');
                    if (kanbanElements && kanbanElements.length > 0) {
                        kanbanElements.forEach(el => {
                            observer.observe(el, {
                                childList: true,
                                subtree: true,
                                attributes: false
                            });
                        });
                        this.debugLog(`MutationObserver attached to ${kanbanElements.length} Kanban elements`);
                    }
                    else {
                        // Fallback to a more targeted observation if no boards found
                        const workspace = document.querySelector('.workspace');
                        if (workspace) {
                            observer.observe(workspace, {
                                childList: true,
                                subtree: true,
                                attributes: false
                            });
                            this.debugLog('MutationObserver attached to workspace (no Kanban boards found yet)');
                        }
                        else {
                            // Last resort - observe body with more restrictions
                            observer.observe(document.body, {
                                childList: true,
                                subtree: true,
                                attributes: false
                            });
                            this.debugLog('MutationObserver attached to document body (fallback mode)');
                        }
                    }
                }
                // Set up a periodic check for new Kanban boards (in case they're added later)
                setInterval(() => {
                    const currentBoards = document.querySelectorAll('.kanban-plugin__board');
                    if (currentBoards && currentBoards.length > 0) {
                        currentBoards.forEach(board => {
                            if (!board.hasAttribute('data-ksu-observed')) {
                                observer.observe(board, {
                                    childList: true,
                                    subtree: true,
                                    attributes: false
                                });
                                board.setAttribute('data-ksu-observed', 'true');
                                this.debugLog('Added observer to new Kanban board');
                            }
                        });
                    }
                }, 10000); // Check every 10 seconds
            });
            // Add settings tab
            this.addSettingTab(new KanbanStatusUpdaterSettingTab(this.app, this));
            // Add a status bar item to show the plugin is active
            this.statusBarItem = this.addStatusBarItem();
            this.statusBarItem.setText('Kanban Status Updater Active');
            this.statusBarItem.addClass('plugin-kanban-status-updater');
            // Check if Kanban plugin is loaded - using safer approach
            try {
                // @ts-ignore - Check if kanban plugin exists using app.plugins (may not be in type definitions)
                const kanbanLoaded = this.app.plugins &&
                    // @ts-ignore
                    ((this.app.plugins.plugins && this.app.plugins.plugins['obsidian-kanban']) ||
                        // @ts-ignore
                        (this.app.plugins.enabledPlugins && this.app.plugins.enabledPlugins.has('obsidian-kanban')));
                if (!kanbanLoaded) {
                    new obsidian.Notice('⚠️ Warning: Kanban plugin might not be enabled. Kanban Status Updater requires it.', 10000);
                    this.debugLog('WARNING: Kanban plugin not detected!');
                }
                else {
                    this.debugLog('Kanban plugin detected');
                }
            }
            catch (e) {
                // If we can't detect it, just log and continue
                this.debugLog(`Couldn't verify Kanban plugin: ${e.message}`);
            }
        });
    }
    onunload() {
        this.debugLog('Plugin unloaded');
        new obsidian.Notice('Kanban Status Updater plugin deactivated');
    }
    loadSettings() {
        return __awaiter(this, void 0, void 0, function* () {
            this.settings = Object.assign({}, DEFAULT_SETTINGS, yield this.loadData());
        });
    }
    saveSettings() {
        return __awaiter(this, void 0, void 0, function* () {
            yield this.saveData(this.settings);
        });
    }
    handleDragEnd(evt) {
        // Check if this was a Kanban-related element being dragged
        const target = evt.target;
        if (!target) {
            this.debugLog('Drag event had no target');
            return;
        }
        this.debugLog(`Drag event detected on element: ${target.tagName} with class ${target.className}`);
        // Determine if this is a Kanban-related drag
        const isKanbanElement = target.className.includes('kanban-plugin__') ||
            target.className.includes('markdown-preview-view') ||
            !!target.closest('[class*="kanban-plugin__"]');
        if (!isKanbanElement) {
            this.debugLog('Not a Kanban-related drag event');
            return;
        }
        this.debugLog('Kanban-related drag detected');
        // Get the item that was dragged (could be a task item or list item)
        const draggedItem = target.closest('li') || target.closest('.task-list-item') || target;
        if (!draggedItem) {
            this.debugLog('Could not identify the dragged item');
            return;
        }
        // Find what column it was dropped into
        const column = this.findKanbanColumn(draggedItem);
        if (!column) {
            this.debugLog('Could not determine destination column');
            return;
        }
        this.debugLog('Found column for dragged item, processing movement');
        // Process the card movement
        this.processCardMovement(draggedItem, column);
    }
    handleDOMMutations(mutations) {
        var _a;
        if (this.processingMutation) {
            this.debugLog('Already processing mutations, skipping');
            return;
        }
        // Process only a sample of mutations if there are too many
        const mutationsToProcess = mutations.length > 10 ?
            mutations.slice(0, 10) : mutations;
        this.debugLog(`Processing ${mutationsToProcess.length} mutations (of ${mutations.length} total)`);
        // Set flag to prevent recursive processing
        this.processingMutation = true;
        try {
            // Clear the pending updates map
            this.pendingCardUpdates.clear();
            // Check for relevant mutations (card being added to a column)
            for (const mutation of mutationsToProcess) {
                if (mutation.type === 'childList') {
                    // Only log if there are actually Kanban-related nodes
                    let foundKanbanElements = false;
                    for (const node of Array.from(mutation.addedNodes)) {
                        if (node instanceof HTMLElement) {
                            // Log all element classes during debug to help identify patterns
                            if (this.settings.debugMode && node.className) {
                                this.debugLog(`Element classes: ${node.className}`);
                            }
                            // Check if this is or contains Kanban-related elements
                            const isKanbanElement = node.className.includes('kanban-plugin__') ||
                                node.className.includes('markdown-preview-view') ||
                                !!node.querySelector('[class*="kanban-plugin__"]') ||
                                !!node.closest('[class*="kanban-plugin__"]');
                            if (isKanbanElement) {
                                foundKanbanElements = true;
                                // Only now log details
                                this.debugLog(`Relevant mutation: ${node.tagName} with class ${node.className}`);
                                // Try to identify potential card elements in several ways
                                // Kanban cards might be list items in the markdown
                                const listItems = node.querySelectorAll('li');
                                const taskListItems = node.querySelectorAll('.task-list-item');
                                const dataItems = node.querySelectorAll('[data-line]'); // Items with data-line attribute
                                const potentialCards = [
                                    ...Array.from(listItems),
                                    ...Array.from(taskListItems),
                                    ...Array.from(dataItems)
                                ];
                                if (potentialCards.length > 0) {
                                    this.debugLog(`Found ${potentialCards.length} potential card elements`);
                                    for (const card of potentialCards) {
                                        // Try to find the column - might be a parent element with a heading
                                        const column = this.findKanbanColumn(card);
                                        if (column) {
                                            // Create a unique ID for this card
                                            const cardText = (_a = card.textContent) === null || _a === void 0 ? void 0 : _a.trim();
                                            const cardId = (cardText === null || cardText === void 0 ? void 0 : cardText.substring(0, 50)) || card.id || 'unknown';
                                            this.debugLog(`Found card: "${cardText === null || cardText === void 0 ? void 0 : cardText.substring(0, 30)}..." in column`);
                                            // Add to pending updates
                                            this.pendingCardUpdates.set(cardId, {
                                                card: card,
                                                column: column
                                            });
                                        }
                                    }
                                }
                                else {
                                    this.debugLog('No potential cards found in Kanban element');
                                }
                            }
                        }
                    }
                    // Only log for mutations with Kanban elements
                    if (foundKanbanElements) {
                        this.debugLog(`Processed mutation with ${mutation.addedNodes.length} nodes`);
                    }
                }
            }
            // Process all pending updates
            if (this.pendingCardUpdates.size > 0) {
                this.debugLog(`Processing ${this.pendingCardUpdates.size} card updates`);
                // Process each card update (with a slight delay between them to avoid overloading)
                let index = 0;
                for (const [cardId, { card, column }] of this.pendingCardUpdates.entries()) {
                    // Stagger processing to avoid too much at once
                    setTimeout(() => {
                        this.processCardMovement(card, column);
                    }, index * 100); // 100ms between each card
                    index++;
                }
            }
        }
        catch (e) {
            this.debugLog(`Error processing mutations: ${e.message}`);
        }
        finally {
            // Clear the flag when done
            setTimeout(() => {
                this.processingMutation = false;
                this.debugLog('Mutation processing complete');
            }, 1000); // Ensure a minimum cool-down period between mutation processing
        }
    }
    // New helper method to find the Kanban column for a card
    findKanbanColumn(card) {
        // Try several strategies to find the column
        // 1. Look for heading elements that might be column headers
        let current = card;
        while (current && current.tagName !== 'BODY') {
            // Check if this element has a heading as a previous sibling or child
            const heading = current.querySelector('h1, h2, h3, h4, h5, h6') ||
                this.findPreviousHeading(current);
            if (heading) {
                this.debugLog(`Found column heading: "${heading.textContent}"`);
                return current;
            }
            current = current.parentElement;
        }
        // 2. Try to find column based on structure - look for container divs
        const containerDiv = card.closest('.markdown-preview-section');
        if (containerDiv) {
            return containerDiv;
        }
        // 3. If we really can't find anything, use the parent of the card
        return card.parentElement;
    }
    // Helper to find the previous heading element
    findPreviousHeading(element) {
        let previous = element.previousElementSibling;
        while (previous) {
            if (previous.matches('h1, h2, h3, h4, h5, h6')) {
                return previous;
            }
            // Also check children of previous siblings (nested headings)
            const nestedHeading = previous.querySelector('h1, h2, h3, h4, h5, h6');
            if (nestedHeading) {
                return nestedHeading;
            }
            previous = previous.previousElementSibling;
        }
        return null;
    }
    processCardMovement(card, column) {
        // Try to determine the column name (new status) from heading elements
        let columnHeader = column.querySelector('h1, h2, h3, h4, h5, h6');
        if (!columnHeader) {
            // If no heading found in the column, try to find it above
            columnHeader = this.findPreviousHeading(column);
        }
        if (!columnHeader) {
            this.debugLog('Could not find column header element');
            return;
        }
        const newStatus = columnHeader.textContent.trim();
        this.debugLog(`Column name (new status): "${newStatus}"`);
        // Get the card content and look for links
        const cardContent = card.textContent || '';
        this.debugLog(`Card content: "${cardContent.substring(0, 50)}${cardContent.length > 50 ? '...' : ''}"`);
        // Try to extract links from the card in multiple ways
        let foundLink = false;
        // 1. First look for wiki-links [[Link]] or [[Link|Display Text]]
        const wikiLinkMatch = cardContent.match(/\[\[(.*?)(?:\|.*?)?\]\]/);
        if (wikiLinkMatch && wikiLinkMatch[1]) {
            const linkPath = wikiLinkMatch[1].trim();
            this.debugLog(`Found wiki-link to: "${linkPath}"`);
            // Show visual confirmation that we're updating
            new obsidian.Notice(`Updating ${this.settings.statusPropertyName} to "${newStatus}" for "${linkPath}"...`, 2000);
            this.updateLinkedNoteStatus(linkPath, newStatus);
            foundLink = true;
        }
        else {
            // 2. Look for regular links or embedded links in the HTML
            const linkElement = card.querySelector('a');
            if (linkElement) {
                const href = linkElement.getAttribute('href');
                if (href && href.startsWith('obsidian://')) {
                    // Extract the note path from obsidian:// URL
                    const linkPath = decodeURIComponent(href.replace('obsidian://open?vault=', '').split('&file=')[1] || '');
                    if (linkPath) {
                        this.debugLog(`Found obsidian link to: "${linkPath}"`);
                        // Show visual confirmation that we're updating
                        new obsidian.Notice(`Updating ${this.settings.statusPropertyName} to "${newStatus}" for "${linkPath}"...`, 2000);
                        this.updateLinkedNoteStatus(linkPath, newStatus);
                        foundLink = true;
                    }
                }
            }
        }
        if (!foundLink) {
            this.debugLog(`No link found in card: ${cardContent}`);
            new obsidian.Notice('⚠️ No link found in Kanban card', 3000);
        }
    }
    updateLinkedNoteStatus(linkPath, newStatus) {
        return __awaiter(this, void 0, void 0, function* () {
            // Find the linked file
            const file = this.app.metadataCache.getFirstLinkpathDest(linkPath, '');
            if (!file) {
                this.debugLog(`Linked file not found: ${linkPath}`);
                new obsidian.Notice(`⚠️ Error: File "${linkPath}" not found`, 5000);
                return;
            }
            this.debugLog(`Found linked file: ${file.path}`);
            try {
                // Read the file content
                const content = yield this.app.vault.read(file);
                this.debugLog(`File content loaded (${content.length} chars)`);
                // Check if the file has frontmatter
                const frontmatterRegex = /^---\n([\s\S]*?)\n---/;
                const frontmatterMatch = content.match(frontmatterRegex);
                let newContent;
                let oldStatus = 'none';
                let action = 'created';
                if (frontmatterMatch) {
                    this.debugLog('File has frontmatter');
                    // File has frontmatter
                    const frontmatterText = frontmatterMatch[1];
                    let frontmatterObj;
                    try {
                        // Try to parse the frontmatter
                        frontmatterObj = obsidian.parseYaml(frontmatterText);
                        this.debugLog('Frontmatter parsed successfully');
                        // Check if status property already exists
                        if (frontmatterObj[this.settings.statusPropertyName]) {
                            oldStatus = frontmatterObj[this.settings.statusPropertyName];
                            action = 'updated';
                        }
                    }
                    catch (e) {
                        this.debugLog(`Error parsing frontmatter: ${e.message}`);
                        new obsidian.Notice(`⚠️ Warning: Invalid frontmatter in ${file.basename}, creating new frontmatter`, 5000);
                        frontmatterObj = {};
                    }
                    // Update the status property
                    frontmatterObj[this.settings.statusPropertyName] = newStatus;
                    // Generate the new frontmatter text
                    const newFrontmatterText = obsidian.stringifyYaml(frontmatterObj);
                    this.debugLog('New frontmatter generated');
                    // Replace the frontmatter in the content
                    newContent = content.replace(frontmatterRegex, `---\n${newFrontmatterText}---`);
                }
                else {
                    this.debugLog('File has no frontmatter, creating new frontmatter');
                    // File has no frontmatter, create it
                    const frontmatterObj = {
                        [this.settings.statusPropertyName]: newStatus
                    };
                    const frontmatterText = obsidian.stringifyYaml(frontmatterObj);
                    newContent = `---\n${frontmatterText}---\n\n${content}`;
                }
                // Save the modified content
                yield this.app.vault.modify(file, newContent);
                this.debugLog('File modified successfully');
                // Show notification with more details
                const banner = createFragment(el => {
                    el.createDiv({
                        text: `✅ ${this.settings.statusPropertyName} ${action}:`,
                        cls: 'status-updated-banner-title'
                    });
                    el.createDiv({
                        cls: 'status-updated-banner-details'
                    }, div => {
                        div.createSpan({ text: 'File: ' });
                        div.createSpan({
                            text: file.basename,
                            cls: 'status-updated-filename'
                        });
                        div.createEl('br');
                        if (action === 'updated') {
                            div.createSpan({ text: 'Changed from: ' });
                            div.createSpan({
                                text: `"${oldStatus}"`,
                                cls: 'status-updated-old-value'
                            });
                            div.createEl('br');
                        }
                        div.createSpan({ text: 'New value: ' });
                        div.createSpan({
                            text: `"${newStatus}"`,
                            cls: 'status-updated-new-value'
                        });
                    });
                });
                // Always show the detailed banner
                new obsidian.Notice(banner, 5000);
                // Update status bar
                this.statusBarItem.setText(`Updated: ${file.basename} → ${newStatus}`);
                setTimeout(() => {
                    this.statusBarItem.setText('Kanban Status Updater Active');
                }, 5000);
                this.debugLog(`Success: ${this.settings.statusPropertyName} for ${file.basename} ${action} from "${oldStatus}" to "${newStatus}"`);
            }
            catch (error) {
                this.debugLog(`Error updating note status: ${error.message}`);
                new obsidian.Notice(`⚠️ Error updating ${this.settings.statusPropertyName} for ${file.basename}: ${error.message}`, 10000);
            }
        });
    }
}
// Settings Tab
class KanbanStatusUpdaterSettingTab extends obsidian.PluginSettingTab {
    constructor(app, plugin) {
        super(app, plugin);
        this.plugin = plugin;
    }
    display() {
        const { containerEl } = this;
        containerEl.empty();
        containerEl.createEl('h2', { text: 'Kanban Status Updater Settings' });
        new obsidian.Setting(containerEl)
            .setName('Status Property Name')
            .setDesc('The name of the property to update when a card is moved')
            .addText(text => text
            .setPlaceholder('status')
            .setValue(this.plugin.settings.statusPropertyName)
            .onChange((value) => __awaiter(this, void 0, void 0, function* () {
            this.plugin.settings.statusPropertyName = value;
            yield this.plugin.saveSettings();
        })));
        new obsidian.Setting(containerEl)
            .setName('Show Notifications')
            .setDesc('Show a notification when a status is updated')
            .addToggle(toggle => toggle
            .setValue(this.plugin.settings.showNotifications)
            .onChange((value) => __awaiter(this, void 0, void 0, function* () {
            this.plugin.settings.showNotifications = value;
            yield this.plugin.saveSettings();
        })));
        new obsidian.Setting(containerEl)
            .setName('Debug Mode')
            .setDesc('Enable detailed logging to console and status bar updates')
            .addToggle(toggle => toggle
            .setValue(this.plugin.settings.debugMode)
            .onChange((value) => __awaiter(this, void 0, void 0, function* () {
            this.plugin.settings.debugMode = value;
            yield this.plugin.saveSettings();
            new obsidian.Notice(`Debug mode ${value ? 'enabled' : 'disabled'}`);
        })));
        // Add a button to trigger a test update
        new obsidian.Setting(containerEl)
            .setName('Test Plugin')
            .setDesc('Run a test to verify plugin functionality')
            .addButton(button => button
            .setButtonText('Run Test')
            .onClick(() => {
            new obsidian.Notice('Test function running - check console for logs');
            this.plugin.debugLog('Test function triggered from settings');
            // Show an example of what a successful update would look like
            const banner = createFragment(el => {
                el.createDiv({
                    text: `✅ ${this.plugin.settings.statusPropertyName} updated:`,
                    cls: 'status-updated-banner-title'
                });
                el.createDiv({
                    cls: 'status-updated-banner-details'
                }, div => {
                    div.createSpan({ text: 'File: ' });
                    div.createSpan({
                        text: 'Example Note',
                        cls: 'status-updated-filename'
                    });
                    div.createEl('br');
                    div.createSpan({ text: 'Changed from: ' });
                    div.createSpan({
                        text: '"In Progress"',
                        cls: 'status-updated-old-value'
                    });
                    div.createEl('br');
                    div.createSpan({ text: 'New value: ' });
                    div.createSpan({
                        text: '"Completed"',
                        cls: 'status-updated-new-value'
                    });
                });
            });
            new obsidian.Notice(banner, 5000);
        }));
        containerEl.createEl('h3', { text: 'Troubleshooting' });
        containerEl.createEl('p', {
            text: 'If the plugin is not working, check the following:'
        });
        const troubleshootingList = containerEl.createEl('ul');
        troubleshootingList.createEl('li', {
            text: 'Ensure the Kanban plugin is installed and enabled'
        });
        troubleshootingList.createEl('li', {
            text: 'Verify your Kanban cards contain wiki-links (e.g., [[Note Title]])'
        });
        troubleshootingList.createEl('li', {
            text: 'Try enabling Debug Mode to see detailed logs in the developer console (Ctrl+Shift+I)'
        });
    }
}

module.exports = KanbanStatusUpdaterPlugin;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibWFpbi5qcyIsInNvdXJjZXMiOlsibm9kZV9tb2R1bGVzL3RzbGliL3RzbGliLmVzNi5qcyIsIm1haW4udHMiXSwic291cmNlc0NvbnRlbnQiOlsiLyoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKlxyXG5Db3B5cmlnaHQgKGMpIE1pY3Jvc29mdCBDb3Jwb3JhdGlvbi5cclxuXHJcblBlcm1pc3Npb24gdG8gdXNlLCBjb3B5LCBtb2RpZnksIGFuZC9vciBkaXN0cmlidXRlIHRoaXMgc29mdHdhcmUgZm9yIGFueVxyXG5wdXJwb3NlIHdpdGggb3Igd2l0aG91dCBmZWUgaXMgaGVyZWJ5IGdyYW50ZWQuXHJcblxyXG5USEUgU09GVFdBUkUgSVMgUFJPVklERUQgXCJBUyBJU1wiIEFORCBUSEUgQVVUSE9SIERJU0NMQUlNUyBBTEwgV0FSUkFOVElFUyBXSVRIXHJcblJFR0FSRCBUTyBUSElTIFNPRlRXQVJFIElOQ0xVRElORyBBTEwgSU1QTElFRCBXQVJSQU5USUVTIE9GIE1FUkNIQU5UQUJJTElUWVxyXG5BTkQgRklUTkVTUy4gSU4gTk8gRVZFTlQgU0hBTEwgVEhFIEFVVEhPUiBCRSBMSUFCTEUgRk9SIEFOWSBTUEVDSUFMLCBESVJFQ1QsXHJcbklORElSRUNULCBPUiBDT05TRVFVRU5USUFMIERBTUFHRVMgT1IgQU5ZIERBTUFHRVMgV0hBVFNPRVZFUiBSRVNVTFRJTkcgRlJPTVxyXG5MT1NTIE9GIFVTRSwgREFUQSBPUiBQUk9GSVRTLCBXSEVUSEVSIElOIEFOIEFDVElPTiBPRiBDT05UUkFDVCwgTkVHTElHRU5DRSBPUlxyXG5PVEhFUiBUT1JUSU9VUyBBQ1RJT04sIEFSSVNJTkcgT1VUIE9GIE9SIElOIENPTk5FQ1RJT04gV0lUSCBUSEUgVVNFIE9SXHJcblBFUkZPUk1BTkNFIE9GIFRISVMgU09GVFdBUkUuXHJcbioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqICovXHJcbi8qIGdsb2JhbCBSZWZsZWN0LCBQcm9taXNlLCBTdXBwcmVzc2VkRXJyb3IsIFN5bWJvbCwgSXRlcmF0b3IgKi9cclxuXHJcbnZhciBleHRlbmRTdGF0aWNzID0gZnVuY3Rpb24oZCwgYikge1xyXG4gICAgZXh0ZW5kU3RhdGljcyA9IE9iamVjdC5zZXRQcm90b3R5cGVPZiB8fFxyXG4gICAgICAgICh7IF9fcHJvdG9fXzogW10gfSBpbnN0YW5jZW9mIEFycmF5ICYmIGZ1bmN0aW9uIChkLCBiKSB7IGQuX19wcm90b19fID0gYjsgfSkgfHxcclxuICAgICAgICBmdW5jdGlvbiAoZCwgYikgeyBmb3IgKHZhciBwIGluIGIpIGlmIChPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwoYiwgcCkpIGRbcF0gPSBiW3BdOyB9O1xyXG4gICAgcmV0dXJuIGV4dGVuZFN0YXRpY3MoZCwgYik7XHJcbn07XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gX19leHRlbmRzKGQsIGIpIHtcclxuICAgIGlmICh0eXBlb2YgYiAhPT0gXCJmdW5jdGlvblwiICYmIGIgIT09IG51bGwpXHJcbiAgICAgICAgdGhyb3cgbmV3IFR5cGVFcnJvcihcIkNsYXNzIGV4dGVuZHMgdmFsdWUgXCIgKyBTdHJpbmcoYikgKyBcIiBpcyBub3QgYSBjb25zdHJ1Y3RvciBvciBudWxsXCIpO1xyXG4gICAgZXh0ZW5kU3RhdGljcyhkLCBiKTtcclxuICAgIGZ1bmN0aW9uIF9fKCkgeyB0aGlzLmNvbnN0cnVjdG9yID0gZDsgfVxyXG4gICAgZC5wcm90b3R5cGUgPSBiID09PSBudWxsID8gT2JqZWN0LmNyZWF0ZShiKSA6IChfXy5wcm90b3R5cGUgPSBiLnByb3RvdHlwZSwgbmV3IF9fKCkpO1xyXG59XHJcblxyXG5leHBvcnQgdmFyIF9fYXNzaWduID0gZnVuY3Rpb24oKSB7XHJcbiAgICBfX2Fzc2lnbiA9IE9iamVjdC5hc3NpZ24gfHwgZnVuY3Rpb24gX19hc3NpZ24odCkge1xyXG4gICAgICAgIGZvciAodmFyIHMsIGkgPSAxLCBuID0gYXJndW1lbnRzLmxlbmd0aDsgaSA8IG47IGkrKykge1xyXG4gICAgICAgICAgICBzID0gYXJndW1lbnRzW2ldO1xyXG4gICAgICAgICAgICBmb3IgKHZhciBwIGluIHMpIGlmIChPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwocywgcCkpIHRbcF0gPSBzW3BdO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gdDtcclxuICAgIH1cclxuICAgIHJldHVybiBfX2Fzc2lnbi5hcHBseSh0aGlzLCBhcmd1bWVudHMpO1xyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gX19yZXN0KHMsIGUpIHtcclxuICAgIHZhciB0ID0ge307XHJcbiAgICBmb3IgKHZhciBwIGluIHMpIGlmIChPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwocywgcCkgJiYgZS5pbmRleE9mKHApIDwgMClcclxuICAgICAgICB0W3BdID0gc1twXTtcclxuICAgIGlmIChzICE9IG51bGwgJiYgdHlwZW9mIE9iamVjdC5nZXRPd25Qcm9wZXJ0eVN5bWJvbHMgPT09IFwiZnVuY3Rpb25cIilcclxuICAgICAgICBmb3IgKHZhciBpID0gMCwgcCA9IE9iamVjdC5nZXRPd25Qcm9wZXJ0eVN5bWJvbHMocyk7IGkgPCBwLmxlbmd0aDsgaSsrKSB7XHJcbiAgICAgICAgICAgIGlmIChlLmluZGV4T2YocFtpXSkgPCAwICYmIE9iamVjdC5wcm90b3R5cGUucHJvcGVydHlJc0VudW1lcmFibGUuY2FsbChzLCBwW2ldKSlcclxuICAgICAgICAgICAgICAgIHRbcFtpXV0gPSBzW3BbaV1dO1xyXG4gICAgICAgIH1cclxuICAgIHJldHVybiB0O1xyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gX19kZWNvcmF0ZShkZWNvcmF0b3JzLCB0YXJnZXQsIGtleSwgZGVzYykge1xyXG4gICAgdmFyIGMgPSBhcmd1bWVudHMubGVuZ3RoLCByID0gYyA8IDMgPyB0YXJnZXQgOiBkZXNjID09PSBudWxsID8gZGVzYyA9IE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IodGFyZ2V0LCBrZXkpIDogZGVzYywgZDtcclxuICAgIGlmICh0eXBlb2YgUmVmbGVjdCA9PT0gXCJvYmplY3RcIiAmJiB0eXBlb2YgUmVmbGVjdC5kZWNvcmF0ZSA9PT0gXCJmdW5jdGlvblwiKSByID0gUmVmbGVjdC5kZWNvcmF0ZShkZWNvcmF0b3JzLCB0YXJnZXQsIGtleSwgZGVzYyk7XHJcbiAgICBlbHNlIGZvciAodmFyIGkgPSBkZWNvcmF0b3JzLmxlbmd0aCAtIDE7IGkgPj0gMDsgaS0tKSBpZiAoZCA9IGRlY29yYXRvcnNbaV0pIHIgPSAoYyA8IDMgPyBkKHIpIDogYyA+IDMgPyBkKHRhcmdldCwga2V5LCByKSA6IGQodGFyZ2V0LCBrZXkpKSB8fCByO1xyXG4gICAgcmV0dXJuIGMgPiAzICYmIHIgJiYgT2JqZWN0LmRlZmluZVByb3BlcnR5KHRhcmdldCwga2V5LCByKSwgcjtcclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIF9fcGFyYW0ocGFyYW1JbmRleCwgZGVjb3JhdG9yKSB7XHJcbiAgICByZXR1cm4gZnVuY3Rpb24gKHRhcmdldCwga2V5KSB7IGRlY29yYXRvcih0YXJnZXQsIGtleSwgcGFyYW1JbmRleCk7IH1cclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIF9fZXNEZWNvcmF0ZShjdG9yLCBkZXNjcmlwdG9ySW4sIGRlY29yYXRvcnMsIGNvbnRleHRJbiwgaW5pdGlhbGl6ZXJzLCBleHRyYUluaXRpYWxpemVycykge1xyXG4gICAgZnVuY3Rpb24gYWNjZXB0KGYpIHsgaWYgKGYgIT09IHZvaWQgMCAmJiB0eXBlb2YgZiAhPT0gXCJmdW5jdGlvblwiKSB0aHJvdyBuZXcgVHlwZUVycm9yKFwiRnVuY3Rpb24gZXhwZWN0ZWRcIik7IHJldHVybiBmOyB9XHJcbiAgICB2YXIga2luZCA9IGNvbnRleHRJbi5raW5kLCBrZXkgPSBraW5kID09PSBcImdldHRlclwiID8gXCJnZXRcIiA6IGtpbmQgPT09IFwic2V0dGVyXCIgPyBcInNldFwiIDogXCJ2YWx1ZVwiO1xyXG4gICAgdmFyIHRhcmdldCA9ICFkZXNjcmlwdG9ySW4gJiYgY3RvciA/IGNvbnRleHRJbltcInN0YXRpY1wiXSA/IGN0b3IgOiBjdG9yLnByb3RvdHlwZSA6IG51bGw7XHJcbiAgICB2YXIgZGVzY3JpcHRvciA9IGRlc2NyaXB0b3JJbiB8fCAodGFyZ2V0ID8gT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcih0YXJnZXQsIGNvbnRleHRJbi5uYW1lKSA6IHt9KTtcclxuICAgIHZhciBfLCBkb25lID0gZmFsc2U7XHJcbiAgICBmb3IgKHZhciBpID0gZGVjb3JhdG9ycy5sZW5ndGggLSAxOyBpID49IDA7IGktLSkge1xyXG4gICAgICAgIHZhciBjb250ZXh0ID0ge307XHJcbiAgICAgICAgZm9yICh2YXIgcCBpbiBjb250ZXh0SW4pIGNvbnRleHRbcF0gPSBwID09PSBcImFjY2Vzc1wiID8ge30gOiBjb250ZXh0SW5bcF07XHJcbiAgICAgICAgZm9yICh2YXIgcCBpbiBjb250ZXh0SW4uYWNjZXNzKSBjb250ZXh0LmFjY2Vzc1twXSA9IGNvbnRleHRJbi5hY2Nlc3NbcF07XHJcbiAgICAgICAgY29udGV4dC5hZGRJbml0aWFsaXplciA9IGZ1bmN0aW9uIChmKSB7IGlmIChkb25lKSB0aHJvdyBuZXcgVHlwZUVycm9yKFwiQ2Fubm90IGFkZCBpbml0aWFsaXplcnMgYWZ0ZXIgZGVjb3JhdGlvbiBoYXMgY29tcGxldGVkXCIpOyBleHRyYUluaXRpYWxpemVycy5wdXNoKGFjY2VwdChmIHx8IG51bGwpKTsgfTtcclxuICAgICAgICB2YXIgcmVzdWx0ID0gKDAsIGRlY29yYXRvcnNbaV0pKGtpbmQgPT09IFwiYWNjZXNzb3JcIiA/IHsgZ2V0OiBkZXNjcmlwdG9yLmdldCwgc2V0OiBkZXNjcmlwdG9yLnNldCB9IDogZGVzY3JpcHRvcltrZXldLCBjb250ZXh0KTtcclxuICAgICAgICBpZiAoa2luZCA9PT0gXCJhY2Nlc3NvclwiKSB7XHJcbiAgICAgICAgICAgIGlmIChyZXN1bHQgPT09IHZvaWQgMCkgY29udGludWU7XHJcbiAgICAgICAgICAgIGlmIChyZXN1bHQgPT09IG51bGwgfHwgdHlwZW9mIHJlc3VsdCAhPT0gXCJvYmplY3RcIikgdGhyb3cgbmV3IFR5cGVFcnJvcihcIk9iamVjdCBleHBlY3RlZFwiKTtcclxuICAgICAgICAgICAgaWYgKF8gPSBhY2NlcHQocmVzdWx0LmdldCkpIGRlc2NyaXB0b3IuZ2V0ID0gXztcclxuICAgICAgICAgICAgaWYgKF8gPSBhY2NlcHQocmVzdWx0LnNldCkpIGRlc2NyaXB0b3Iuc2V0ID0gXztcclxuICAgICAgICAgICAgaWYgKF8gPSBhY2NlcHQocmVzdWx0LmluaXQpKSBpbml0aWFsaXplcnMudW5zaGlmdChfKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSBpZiAoXyA9IGFjY2VwdChyZXN1bHQpKSB7XHJcbiAgICAgICAgICAgIGlmIChraW5kID09PSBcImZpZWxkXCIpIGluaXRpYWxpemVycy51bnNoaWZ0KF8pO1xyXG4gICAgICAgICAgICBlbHNlIGRlc2NyaXB0b3Jba2V5XSA9IF87XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG4gICAgaWYgKHRhcmdldCkgT2JqZWN0LmRlZmluZVByb3BlcnR5KHRhcmdldCwgY29udGV4dEluLm5hbWUsIGRlc2NyaXB0b3IpO1xyXG4gICAgZG9uZSA9IHRydWU7XHJcbn07XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gX19ydW5Jbml0aWFsaXplcnModGhpc0FyZywgaW5pdGlhbGl6ZXJzLCB2YWx1ZSkge1xyXG4gICAgdmFyIHVzZVZhbHVlID0gYXJndW1lbnRzLmxlbmd0aCA+IDI7XHJcbiAgICBmb3IgKHZhciBpID0gMDsgaSA8IGluaXRpYWxpemVycy5sZW5ndGg7IGkrKykge1xyXG4gICAgICAgIHZhbHVlID0gdXNlVmFsdWUgPyBpbml0aWFsaXplcnNbaV0uY2FsbCh0aGlzQXJnLCB2YWx1ZSkgOiBpbml0aWFsaXplcnNbaV0uY2FsbCh0aGlzQXJnKTtcclxuICAgIH1cclxuICAgIHJldHVybiB1c2VWYWx1ZSA/IHZhbHVlIDogdm9pZCAwO1xyXG59O1xyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIF9fcHJvcEtleSh4KSB7XHJcbiAgICByZXR1cm4gdHlwZW9mIHggPT09IFwic3ltYm9sXCIgPyB4IDogXCJcIi5jb25jYXQoeCk7XHJcbn07XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gX19zZXRGdW5jdGlvbk5hbWUoZiwgbmFtZSwgcHJlZml4KSB7XHJcbiAgICBpZiAodHlwZW9mIG5hbWUgPT09IFwic3ltYm9sXCIpIG5hbWUgPSBuYW1lLmRlc2NyaXB0aW9uID8gXCJbXCIuY29uY2F0KG5hbWUuZGVzY3JpcHRpb24sIFwiXVwiKSA6IFwiXCI7XHJcbiAgICByZXR1cm4gT2JqZWN0LmRlZmluZVByb3BlcnR5KGYsIFwibmFtZVwiLCB7IGNvbmZpZ3VyYWJsZTogdHJ1ZSwgdmFsdWU6IHByZWZpeCA/IFwiXCIuY29uY2F0KHByZWZpeCwgXCIgXCIsIG5hbWUpIDogbmFtZSB9KTtcclxufTtcclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBfX21ldGFkYXRhKG1ldGFkYXRhS2V5LCBtZXRhZGF0YVZhbHVlKSB7XHJcbiAgICBpZiAodHlwZW9mIFJlZmxlY3QgPT09IFwib2JqZWN0XCIgJiYgdHlwZW9mIFJlZmxlY3QubWV0YWRhdGEgPT09IFwiZnVuY3Rpb25cIikgcmV0dXJuIFJlZmxlY3QubWV0YWRhdGEobWV0YWRhdGFLZXksIG1ldGFkYXRhVmFsdWUpO1xyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gX19hd2FpdGVyKHRoaXNBcmcsIF9hcmd1bWVudHMsIFAsIGdlbmVyYXRvcikge1xyXG4gICAgZnVuY3Rpb24gYWRvcHQodmFsdWUpIHsgcmV0dXJuIHZhbHVlIGluc3RhbmNlb2YgUCA/IHZhbHVlIDogbmV3IFAoZnVuY3Rpb24gKHJlc29sdmUpIHsgcmVzb2x2ZSh2YWx1ZSk7IH0pOyB9XHJcbiAgICByZXR1cm4gbmV3IChQIHx8IChQID0gUHJvbWlzZSkpKGZ1bmN0aW9uIChyZXNvbHZlLCByZWplY3QpIHtcclxuICAgICAgICBmdW5jdGlvbiBmdWxmaWxsZWQodmFsdWUpIHsgdHJ5IHsgc3RlcChnZW5lcmF0b3IubmV4dCh2YWx1ZSkpOyB9IGNhdGNoIChlKSB7IHJlamVjdChlKTsgfSB9XHJcbiAgICAgICAgZnVuY3Rpb24gcmVqZWN0ZWQodmFsdWUpIHsgdHJ5IHsgc3RlcChnZW5lcmF0b3JbXCJ0aHJvd1wiXSh2YWx1ZSkpOyB9IGNhdGNoIChlKSB7IHJlamVjdChlKTsgfSB9XHJcbiAgICAgICAgZnVuY3Rpb24gc3RlcChyZXN1bHQpIHsgcmVzdWx0LmRvbmUgPyByZXNvbHZlKHJlc3VsdC52YWx1ZSkgOiBhZG9wdChyZXN1bHQudmFsdWUpLnRoZW4oZnVsZmlsbGVkLCByZWplY3RlZCk7IH1cclxuICAgICAgICBzdGVwKChnZW5lcmF0b3IgPSBnZW5lcmF0b3IuYXBwbHkodGhpc0FyZywgX2FyZ3VtZW50cyB8fCBbXSkpLm5leHQoKSk7XHJcbiAgICB9KTtcclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIF9fZ2VuZXJhdG9yKHRoaXNBcmcsIGJvZHkpIHtcclxuICAgIHZhciBfID0geyBsYWJlbDogMCwgc2VudDogZnVuY3Rpb24oKSB7IGlmICh0WzBdICYgMSkgdGhyb3cgdFsxXTsgcmV0dXJuIHRbMV07IH0sIHRyeXM6IFtdLCBvcHM6IFtdIH0sIGYsIHksIHQsIGcgPSBPYmplY3QuY3JlYXRlKCh0eXBlb2YgSXRlcmF0b3IgPT09IFwiZnVuY3Rpb25cIiA/IEl0ZXJhdG9yIDogT2JqZWN0KS5wcm90b3R5cGUpO1xyXG4gICAgcmV0dXJuIGcubmV4dCA9IHZlcmIoMCksIGdbXCJ0aHJvd1wiXSA9IHZlcmIoMSksIGdbXCJyZXR1cm5cIl0gPSB2ZXJiKDIpLCB0eXBlb2YgU3ltYm9sID09PSBcImZ1bmN0aW9uXCIgJiYgKGdbU3ltYm9sLml0ZXJhdG9yXSA9IGZ1bmN0aW9uKCkgeyByZXR1cm4gdGhpczsgfSksIGc7XHJcbiAgICBmdW5jdGlvbiB2ZXJiKG4pIHsgcmV0dXJuIGZ1bmN0aW9uICh2KSB7IHJldHVybiBzdGVwKFtuLCB2XSk7IH07IH1cclxuICAgIGZ1bmN0aW9uIHN0ZXAob3ApIHtcclxuICAgICAgICBpZiAoZikgdGhyb3cgbmV3IFR5cGVFcnJvcihcIkdlbmVyYXRvciBpcyBhbHJlYWR5IGV4ZWN1dGluZy5cIik7XHJcbiAgICAgICAgd2hpbGUgKGcgJiYgKGcgPSAwLCBvcFswXSAmJiAoXyA9IDApKSwgXykgdHJ5IHtcclxuICAgICAgICAgICAgaWYgKGYgPSAxLCB5ICYmICh0ID0gb3BbMF0gJiAyID8geVtcInJldHVyblwiXSA6IG9wWzBdID8geVtcInRocm93XCJdIHx8ICgodCA9IHlbXCJyZXR1cm5cIl0pICYmIHQuY2FsbCh5KSwgMCkgOiB5Lm5leHQpICYmICEodCA9IHQuY2FsbCh5LCBvcFsxXSkpLmRvbmUpIHJldHVybiB0O1xyXG4gICAgICAgICAgICBpZiAoeSA9IDAsIHQpIG9wID0gW29wWzBdICYgMiwgdC52YWx1ZV07XHJcbiAgICAgICAgICAgIHN3aXRjaCAob3BbMF0pIHtcclxuICAgICAgICAgICAgICAgIGNhc2UgMDogY2FzZSAxOiB0ID0gb3A7IGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgY2FzZSA0OiBfLmxhYmVsKys7IHJldHVybiB7IHZhbHVlOiBvcFsxXSwgZG9uZTogZmFsc2UgfTtcclxuICAgICAgICAgICAgICAgIGNhc2UgNTogXy5sYWJlbCsrOyB5ID0gb3BbMV07IG9wID0gWzBdOyBjb250aW51ZTtcclxuICAgICAgICAgICAgICAgIGNhc2UgNzogb3AgPSBfLm9wcy5wb3AoKTsgXy50cnlzLnBvcCgpOyBjb250aW51ZTtcclxuICAgICAgICAgICAgICAgIGRlZmF1bHQ6XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKCEodCA9IF8udHJ5cywgdCA9IHQubGVuZ3RoID4gMCAmJiB0W3QubGVuZ3RoIC0gMV0pICYmIChvcFswXSA9PT0gNiB8fCBvcFswXSA9PT0gMikpIHsgXyA9IDA7IGNvbnRpbnVlOyB9XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKG9wWzBdID09PSAzICYmICghdCB8fCAob3BbMV0gPiB0WzBdICYmIG9wWzFdIDwgdFszXSkpKSB7IF8ubGFiZWwgPSBvcFsxXTsgYnJlYWs7IH1cclxuICAgICAgICAgICAgICAgICAgICBpZiAob3BbMF0gPT09IDYgJiYgXy5sYWJlbCA8IHRbMV0pIHsgXy5sYWJlbCA9IHRbMV07IHQgPSBvcDsgYnJlYWs7IH1cclxuICAgICAgICAgICAgICAgICAgICBpZiAodCAmJiBfLmxhYmVsIDwgdFsyXSkgeyBfLmxhYmVsID0gdFsyXTsgXy5vcHMucHVzaChvcCk7IGJyZWFrOyB9XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHRbMl0pIF8ub3BzLnBvcCgpO1xyXG4gICAgICAgICAgICAgICAgICAgIF8udHJ5cy5wb3AoKTsgY29udGludWU7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgb3AgPSBib2R5LmNhbGwodGhpc0FyZywgXyk7XHJcbiAgICAgICAgfSBjYXRjaCAoZSkgeyBvcCA9IFs2LCBlXTsgeSA9IDA7IH0gZmluYWxseSB7IGYgPSB0ID0gMDsgfVxyXG4gICAgICAgIGlmIChvcFswXSAmIDUpIHRocm93IG9wWzFdOyByZXR1cm4geyB2YWx1ZTogb3BbMF0gPyBvcFsxXSA6IHZvaWQgMCwgZG9uZTogdHJ1ZSB9O1xyXG4gICAgfVxyXG59XHJcblxyXG5leHBvcnQgdmFyIF9fY3JlYXRlQmluZGluZyA9IE9iamVjdC5jcmVhdGUgPyAoZnVuY3Rpb24obywgbSwgaywgazIpIHtcclxuICAgIGlmIChrMiA9PT0gdW5kZWZpbmVkKSBrMiA9IGs7XHJcbiAgICB2YXIgZGVzYyA9IE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IobSwgayk7XHJcbiAgICBpZiAoIWRlc2MgfHwgKFwiZ2V0XCIgaW4gZGVzYyA/ICFtLl9fZXNNb2R1bGUgOiBkZXNjLndyaXRhYmxlIHx8IGRlc2MuY29uZmlndXJhYmxlKSkge1xyXG4gICAgICAgIGRlc2MgPSB7IGVudW1lcmFibGU6IHRydWUsIGdldDogZnVuY3Rpb24oKSB7IHJldHVybiBtW2tdOyB9IH07XHJcbiAgICB9XHJcbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkobywgazIsIGRlc2MpO1xyXG59KSA6IChmdW5jdGlvbihvLCBtLCBrLCBrMikge1xyXG4gICAgaWYgKGsyID09PSB1bmRlZmluZWQpIGsyID0gaztcclxuICAgIG9bazJdID0gbVtrXTtcclxufSk7XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gX19leHBvcnRTdGFyKG0sIG8pIHtcclxuICAgIGZvciAodmFyIHAgaW4gbSkgaWYgKHAgIT09IFwiZGVmYXVsdFwiICYmICFPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwobywgcCkpIF9fY3JlYXRlQmluZGluZyhvLCBtLCBwKTtcclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIF9fdmFsdWVzKG8pIHtcclxuICAgIHZhciBzID0gdHlwZW9mIFN5bWJvbCA9PT0gXCJmdW5jdGlvblwiICYmIFN5bWJvbC5pdGVyYXRvciwgbSA9IHMgJiYgb1tzXSwgaSA9IDA7XHJcbiAgICBpZiAobSkgcmV0dXJuIG0uY2FsbChvKTtcclxuICAgIGlmIChvICYmIHR5cGVvZiBvLmxlbmd0aCA9PT0gXCJudW1iZXJcIikgcmV0dXJuIHtcclxuICAgICAgICBuZXh0OiBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIGlmIChvICYmIGkgPj0gby5sZW5ndGgpIG8gPSB2b2lkIDA7XHJcbiAgICAgICAgICAgIHJldHVybiB7IHZhbHVlOiBvICYmIG9baSsrXSwgZG9uZTogIW8gfTtcclxuICAgICAgICB9XHJcbiAgICB9O1xyXG4gICAgdGhyb3cgbmV3IFR5cGVFcnJvcihzID8gXCJPYmplY3QgaXMgbm90IGl0ZXJhYmxlLlwiIDogXCJTeW1ib2wuaXRlcmF0b3IgaXMgbm90IGRlZmluZWQuXCIpO1xyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gX19yZWFkKG8sIG4pIHtcclxuICAgIHZhciBtID0gdHlwZW9mIFN5bWJvbCA9PT0gXCJmdW5jdGlvblwiICYmIG9bU3ltYm9sLml0ZXJhdG9yXTtcclxuICAgIGlmICghbSkgcmV0dXJuIG87XHJcbiAgICB2YXIgaSA9IG0uY2FsbChvKSwgciwgYXIgPSBbXSwgZTtcclxuICAgIHRyeSB7XHJcbiAgICAgICAgd2hpbGUgKChuID09PSB2b2lkIDAgfHwgbi0tID4gMCkgJiYgIShyID0gaS5uZXh0KCkpLmRvbmUpIGFyLnB1c2goci52YWx1ZSk7XHJcbiAgICB9XHJcbiAgICBjYXRjaCAoZXJyb3IpIHsgZSA9IHsgZXJyb3I6IGVycm9yIH07IH1cclxuICAgIGZpbmFsbHkge1xyXG4gICAgICAgIHRyeSB7XHJcbiAgICAgICAgICAgIGlmIChyICYmICFyLmRvbmUgJiYgKG0gPSBpW1wicmV0dXJuXCJdKSkgbS5jYWxsKGkpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBmaW5hbGx5IHsgaWYgKGUpIHRocm93IGUuZXJyb3I7IH1cclxuICAgIH1cclxuICAgIHJldHVybiBhcjtcclxufVxyXG5cclxuLyoqIEBkZXByZWNhdGVkICovXHJcbmV4cG9ydCBmdW5jdGlvbiBfX3NwcmVhZCgpIHtcclxuICAgIGZvciAodmFyIGFyID0gW10sIGkgPSAwOyBpIDwgYXJndW1lbnRzLmxlbmd0aDsgaSsrKVxyXG4gICAgICAgIGFyID0gYXIuY29uY2F0KF9fcmVhZChhcmd1bWVudHNbaV0pKTtcclxuICAgIHJldHVybiBhcjtcclxufVxyXG5cclxuLyoqIEBkZXByZWNhdGVkICovXHJcbmV4cG9ydCBmdW5jdGlvbiBfX3NwcmVhZEFycmF5cygpIHtcclxuICAgIGZvciAodmFyIHMgPSAwLCBpID0gMCwgaWwgPSBhcmd1bWVudHMubGVuZ3RoOyBpIDwgaWw7IGkrKykgcyArPSBhcmd1bWVudHNbaV0ubGVuZ3RoO1xyXG4gICAgZm9yICh2YXIgciA9IEFycmF5KHMpLCBrID0gMCwgaSA9IDA7IGkgPCBpbDsgaSsrKVxyXG4gICAgICAgIGZvciAodmFyIGEgPSBhcmd1bWVudHNbaV0sIGogPSAwLCBqbCA9IGEubGVuZ3RoOyBqIDwgamw7IGorKywgaysrKVxyXG4gICAgICAgICAgICByW2tdID0gYVtqXTtcclxuICAgIHJldHVybiByO1xyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gX19zcHJlYWRBcnJheSh0bywgZnJvbSwgcGFjaykge1xyXG4gICAgaWYgKHBhY2sgfHwgYXJndW1lbnRzLmxlbmd0aCA9PT0gMikgZm9yICh2YXIgaSA9IDAsIGwgPSBmcm9tLmxlbmd0aCwgYXI7IGkgPCBsOyBpKyspIHtcclxuICAgICAgICBpZiAoYXIgfHwgIShpIGluIGZyb20pKSB7XHJcbiAgICAgICAgICAgIGlmICghYXIpIGFyID0gQXJyYXkucHJvdG90eXBlLnNsaWNlLmNhbGwoZnJvbSwgMCwgaSk7XHJcbiAgICAgICAgICAgIGFyW2ldID0gZnJvbVtpXTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbiAgICByZXR1cm4gdG8uY29uY2F0KGFyIHx8IEFycmF5LnByb3RvdHlwZS5zbGljZS5jYWxsKGZyb20pKTtcclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIF9fYXdhaXQodikge1xyXG4gICAgcmV0dXJuIHRoaXMgaW5zdGFuY2VvZiBfX2F3YWl0ID8gKHRoaXMudiA9IHYsIHRoaXMpIDogbmV3IF9fYXdhaXQodik7XHJcbn1cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBfX2FzeW5jR2VuZXJhdG9yKHRoaXNBcmcsIF9hcmd1bWVudHMsIGdlbmVyYXRvcikge1xyXG4gICAgaWYgKCFTeW1ib2wuYXN5bmNJdGVyYXRvcikgdGhyb3cgbmV3IFR5cGVFcnJvcihcIlN5bWJvbC5hc3luY0l0ZXJhdG9yIGlzIG5vdCBkZWZpbmVkLlwiKTtcclxuICAgIHZhciBnID0gZ2VuZXJhdG9yLmFwcGx5KHRoaXNBcmcsIF9hcmd1bWVudHMgfHwgW10pLCBpLCBxID0gW107XHJcbiAgICByZXR1cm4gaSA9IE9iamVjdC5jcmVhdGUoKHR5cGVvZiBBc3luY0l0ZXJhdG9yID09PSBcImZ1bmN0aW9uXCIgPyBBc3luY0l0ZXJhdG9yIDogT2JqZWN0KS5wcm90b3R5cGUpLCB2ZXJiKFwibmV4dFwiKSwgdmVyYihcInRocm93XCIpLCB2ZXJiKFwicmV0dXJuXCIsIGF3YWl0UmV0dXJuKSwgaVtTeW1ib2wuYXN5bmNJdGVyYXRvcl0gPSBmdW5jdGlvbiAoKSB7IHJldHVybiB0aGlzOyB9LCBpO1xyXG4gICAgZnVuY3Rpb24gYXdhaXRSZXR1cm4oZikgeyByZXR1cm4gZnVuY3Rpb24gKHYpIHsgcmV0dXJuIFByb21pc2UucmVzb2x2ZSh2KS50aGVuKGYsIHJlamVjdCk7IH07IH1cclxuICAgIGZ1bmN0aW9uIHZlcmIobiwgZikgeyBpZiAoZ1tuXSkgeyBpW25dID0gZnVuY3Rpb24gKHYpIHsgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uIChhLCBiKSB7IHEucHVzaChbbiwgdiwgYSwgYl0pID4gMSB8fCByZXN1bWUobiwgdik7IH0pOyB9OyBpZiAoZikgaVtuXSA9IGYoaVtuXSk7IH0gfVxyXG4gICAgZnVuY3Rpb24gcmVzdW1lKG4sIHYpIHsgdHJ5IHsgc3RlcChnW25dKHYpKTsgfSBjYXRjaCAoZSkgeyBzZXR0bGUocVswXVszXSwgZSk7IH0gfVxyXG4gICAgZnVuY3Rpb24gc3RlcChyKSB7IHIudmFsdWUgaW5zdGFuY2VvZiBfX2F3YWl0ID8gUHJvbWlzZS5yZXNvbHZlKHIudmFsdWUudikudGhlbihmdWxmaWxsLCByZWplY3QpIDogc2V0dGxlKHFbMF1bMl0sIHIpOyB9XHJcbiAgICBmdW5jdGlvbiBmdWxmaWxsKHZhbHVlKSB7IHJlc3VtZShcIm5leHRcIiwgdmFsdWUpOyB9XHJcbiAgICBmdW5jdGlvbiByZWplY3QodmFsdWUpIHsgcmVzdW1lKFwidGhyb3dcIiwgdmFsdWUpOyB9XHJcbiAgICBmdW5jdGlvbiBzZXR0bGUoZiwgdikgeyBpZiAoZih2KSwgcS5zaGlmdCgpLCBxLmxlbmd0aCkgcmVzdW1lKHFbMF1bMF0sIHFbMF1bMV0pOyB9XHJcbn1cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBfX2FzeW5jRGVsZWdhdG9yKG8pIHtcclxuICAgIHZhciBpLCBwO1xyXG4gICAgcmV0dXJuIGkgPSB7fSwgdmVyYihcIm5leHRcIiksIHZlcmIoXCJ0aHJvd1wiLCBmdW5jdGlvbiAoZSkgeyB0aHJvdyBlOyB9KSwgdmVyYihcInJldHVyblwiKSwgaVtTeW1ib2wuaXRlcmF0b3JdID0gZnVuY3Rpb24gKCkgeyByZXR1cm4gdGhpczsgfSwgaTtcclxuICAgIGZ1bmN0aW9uIHZlcmIobiwgZikgeyBpW25dID0gb1tuXSA/IGZ1bmN0aW9uICh2KSB7IHJldHVybiAocCA9ICFwKSA/IHsgdmFsdWU6IF9fYXdhaXQob1tuXSh2KSksIGRvbmU6IGZhbHNlIH0gOiBmID8gZih2KSA6IHY7IH0gOiBmOyB9XHJcbn1cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBfX2FzeW5jVmFsdWVzKG8pIHtcclxuICAgIGlmICghU3ltYm9sLmFzeW5jSXRlcmF0b3IpIHRocm93IG5ldyBUeXBlRXJyb3IoXCJTeW1ib2wuYXN5bmNJdGVyYXRvciBpcyBub3QgZGVmaW5lZC5cIik7XHJcbiAgICB2YXIgbSA9IG9bU3ltYm9sLmFzeW5jSXRlcmF0b3JdLCBpO1xyXG4gICAgcmV0dXJuIG0gPyBtLmNhbGwobykgOiAobyA9IHR5cGVvZiBfX3ZhbHVlcyA9PT0gXCJmdW5jdGlvblwiID8gX192YWx1ZXMobykgOiBvW1N5bWJvbC5pdGVyYXRvcl0oKSwgaSA9IHt9LCB2ZXJiKFwibmV4dFwiKSwgdmVyYihcInRocm93XCIpLCB2ZXJiKFwicmV0dXJuXCIpLCBpW1N5bWJvbC5hc3luY0l0ZXJhdG9yXSA9IGZ1bmN0aW9uICgpIHsgcmV0dXJuIHRoaXM7IH0sIGkpO1xyXG4gICAgZnVuY3Rpb24gdmVyYihuKSB7IGlbbl0gPSBvW25dICYmIGZ1bmN0aW9uICh2KSB7IHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbiAocmVzb2x2ZSwgcmVqZWN0KSB7IHYgPSBvW25dKHYpLCBzZXR0bGUocmVzb2x2ZSwgcmVqZWN0LCB2LmRvbmUsIHYudmFsdWUpOyB9KTsgfTsgfVxyXG4gICAgZnVuY3Rpb24gc2V0dGxlKHJlc29sdmUsIHJlamVjdCwgZCwgdikgeyBQcm9taXNlLnJlc29sdmUodikudGhlbihmdW5jdGlvbih2KSB7IHJlc29sdmUoeyB2YWx1ZTogdiwgZG9uZTogZCB9KTsgfSwgcmVqZWN0KTsgfVxyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gX19tYWtlVGVtcGxhdGVPYmplY3QoY29va2VkLCByYXcpIHtcclxuICAgIGlmIChPYmplY3QuZGVmaW5lUHJvcGVydHkpIHsgT2JqZWN0LmRlZmluZVByb3BlcnR5KGNvb2tlZCwgXCJyYXdcIiwgeyB2YWx1ZTogcmF3IH0pOyB9IGVsc2UgeyBjb29rZWQucmF3ID0gcmF3OyB9XHJcbiAgICByZXR1cm4gY29va2VkO1xyXG59O1xyXG5cclxudmFyIF9fc2V0TW9kdWxlRGVmYXVsdCA9IE9iamVjdC5jcmVhdGUgPyAoZnVuY3Rpb24obywgdikge1xyXG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KG8sIFwiZGVmYXVsdFwiLCB7IGVudW1lcmFibGU6IHRydWUsIHZhbHVlOiB2IH0pO1xyXG59KSA6IGZ1bmN0aW9uKG8sIHYpIHtcclxuICAgIG9bXCJkZWZhdWx0XCJdID0gdjtcclxufTtcclxuXHJcbnZhciBvd25LZXlzID0gZnVuY3Rpb24obykge1xyXG4gICAgb3duS2V5cyA9IE9iamVjdC5nZXRPd25Qcm9wZXJ0eU5hbWVzIHx8IGZ1bmN0aW9uIChvKSB7XHJcbiAgICAgICAgdmFyIGFyID0gW107XHJcbiAgICAgICAgZm9yICh2YXIgayBpbiBvKSBpZiAoT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKG8sIGspKSBhclthci5sZW5ndGhdID0gaztcclxuICAgICAgICByZXR1cm4gYXI7XHJcbiAgICB9O1xyXG4gICAgcmV0dXJuIG93bktleXMobyk7XHJcbn07XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gX19pbXBvcnRTdGFyKG1vZCkge1xyXG4gICAgaWYgKG1vZCAmJiBtb2QuX19lc01vZHVsZSkgcmV0dXJuIG1vZDtcclxuICAgIHZhciByZXN1bHQgPSB7fTtcclxuICAgIGlmIChtb2QgIT0gbnVsbCkgZm9yICh2YXIgayA9IG93bktleXMobW9kKSwgaSA9IDA7IGkgPCBrLmxlbmd0aDsgaSsrKSBpZiAoa1tpXSAhPT0gXCJkZWZhdWx0XCIpIF9fY3JlYXRlQmluZGluZyhyZXN1bHQsIG1vZCwga1tpXSk7XHJcbiAgICBfX3NldE1vZHVsZURlZmF1bHQocmVzdWx0LCBtb2QpO1xyXG4gICAgcmV0dXJuIHJlc3VsdDtcclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIF9faW1wb3J0RGVmYXVsdChtb2QpIHtcclxuICAgIHJldHVybiAobW9kICYmIG1vZC5fX2VzTW9kdWxlKSA/IG1vZCA6IHsgZGVmYXVsdDogbW9kIH07XHJcbn1cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBfX2NsYXNzUHJpdmF0ZUZpZWxkR2V0KHJlY2VpdmVyLCBzdGF0ZSwga2luZCwgZikge1xyXG4gICAgaWYgKGtpbmQgPT09IFwiYVwiICYmICFmKSB0aHJvdyBuZXcgVHlwZUVycm9yKFwiUHJpdmF0ZSBhY2Nlc3NvciB3YXMgZGVmaW5lZCB3aXRob3V0IGEgZ2V0dGVyXCIpO1xyXG4gICAgaWYgKHR5cGVvZiBzdGF0ZSA9PT0gXCJmdW5jdGlvblwiID8gcmVjZWl2ZXIgIT09IHN0YXRlIHx8ICFmIDogIXN0YXRlLmhhcyhyZWNlaXZlcikpIHRocm93IG5ldyBUeXBlRXJyb3IoXCJDYW5ub3QgcmVhZCBwcml2YXRlIG1lbWJlciBmcm9tIGFuIG9iamVjdCB3aG9zZSBjbGFzcyBkaWQgbm90IGRlY2xhcmUgaXRcIik7XHJcbiAgICByZXR1cm4ga2luZCA9PT0gXCJtXCIgPyBmIDoga2luZCA9PT0gXCJhXCIgPyBmLmNhbGwocmVjZWl2ZXIpIDogZiA/IGYudmFsdWUgOiBzdGF0ZS5nZXQocmVjZWl2ZXIpO1xyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gX19jbGFzc1ByaXZhdGVGaWVsZFNldChyZWNlaXZlciwgc3RhdGUsIHZhbHVlLCBraW5kLCBmKSB7XHJcbiAgICBpZiAoa2luZCA9PT0gXCJtXCIpIHRocm93IG5ldyBUeXBlRXJyb3IoXCJQcml2YXRlIG1ldGhvZCBpcyBub3Qgd3JpdGFibGVcIik7XHJcbiAgICBpZiAoa2luZCA9PT0gXCJhXCIgJiYgIWYpIHRocm93IG5ldyBUeXBlRXJyb3IoXCJQcml2YXRlIGFjY2Vzc29yIHdhcyBkZWZpbmVkIHdpdGhvdXQgYSBzZXR0ZXJcIik7XHJcbiAgICBpZiAodHlwZW9mIHN0YXRlID09PSBcImZ1bmN0aW9uXCIgPyByZWNlaXZlciAhPT0gc3RhdGUgfHwgIWYgOiAhc3RhdGUuaGFzKHJlY2VpdmVyKSkgdGhyb3cgbmV3IFR5cGVFcnJvcihcIkNhbm5vdCB3cml0ZSBwcml2YXRlIG1lbWJlciB0byBhbiBvYmplY3Qgd2hvc2UgY2xhc3MgZGlkIG5vdCBkZWNsYXJlIGl0XCIpO1xyXG4gICAgcmV0dXJuIChraW5kID09PSBcImFcIiA/IGYuY2FsbChyZWNlaXZlciwgdmFsdWUpIDogZiA/IGYudmFsdWUgPSB2YWx1ZSA6IHN0YXRlLnNldChyZWNlaXZlciwgdmFsdWUpKSwgdmFsdWU7XHJcbn1cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBfX2NsYXNzUHJpdmF0ZUZpZWxkSW4oc3RhdGUsIHJlY2VpdmVyKSB7XHJcbiAgICBpZiAocmVjZWl2ZXIgPT09IG51bGwgfHwgKHR5cGVvZiByZWNlaXZlciAhPT0gXCJvYmplY3RcIiAmJiB0eXBlb2YgcmVjZWl2ZXIgIT09IFwiZnVuY3Rpb25cIikpIHRocm93IG5ldyBUeXBlRXJyb3IoXCJDYW5ub3QgdXNlICdpbicgb3BlcmF0b3Igb24gbm9uLW9iamVjdFwiKTtcclxuICAgIHJldHVybiB0eXBlb2Ygc3RhdGUgPT09IFwiZnVuY3Rpb25cIiA/IHJlY2VpdmVyID09PSBzdGF0ZSA6IHN0YXRlLmhhcyhyZWNlaXZlcik7XHJcbn1cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBfX2FkZERpc3Bvc2FibGVSZXNvdXJjZShlbnYsIHZhbHVlLCBhc3luYykge1xyXG4gICAgaWYgKHZhbHVlICE9PSBudWxsICYmIHZhbHVlICE9PSB2b2lkIDApIHtcclxuICAgICAgICBpZiAodHlwZW9mIHZhbHVlICE9PSBcIm9iamVjdFwiICYmIHR5cGVvZiB2YWx1ZSAhPT0gXCJmdW5jdGlvblwiKSB0aHJvdyBuZXcgVHlwZUVycm9yKFwiT2JqZWN0IGV4cGVjdGVkLlwiKTtcclxuICAgICAgICB2YXIgZGlzcG9zZSwgaW5uZXI7XHJcbiAgICAgICAgaWYgKGFzeW5jKSB7XHJcbiAgICAgICAgICAgIGlmICghU3ltYm9sLmFzeW5jRGlzcG9zZSkgdGhyb3cgbmV3IFR5cGVFcnJvcihcIlN5bWJvbC5hc3luY0Rpc3Bvc2UgaXMgbm90IGRlZmluZWQuXCIpO1xyXG4gICAgICAgICAgICBkaXNwb3NlID0gdmFsdWVbU3ltYm9sLmFzeW5jRGlzcG9zZV07XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmIChkaXNwb3NlID09PSB2b2lkIDApIHtcclxuICAgICAgICAgICAgaWYgKCFTeW1ib2wuZGlzcG9zZSkgdGhyb3cgbmV3IFR5cGVFcnJvcihcIlN5bWJvbC5kaXNwb3NlIGlzIG5vdCBkZWZpbmVkLlwiKTtcclxuICAgICAgICAgICAgZGlzcG9zZSA9IHZhbHVlW1N5bWJvbC5kaXNwb3NlXTtcclxuICAgICAgICAgICAgaWYgKGFzeW5jKSBpbm5lciA9IGRpc3Bvc2U7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmICh0eXBlb2YgZGlzcG9zZSAhPT0gXCJmdW5jdGlvblwiKSB0aHJvdyBuZXcgVHlwZUVycm9yKFwiT2JqZWN0IG5vdCBkaXNwb3NhYmxlLlwiKTtcclxuICAgICAgICBpZiAoaW5uZXIpIGRpc3Bvc2UgPSBmdW5jdGlvbigpIHsgdHJ5IHsgaW5uZXIuY2FsbCh0aGlzKTsgfSBjYXRjaCAoZSkgeyByZXR1cm4gUHJvbWlzZS5yZWplY3QoZSk7IH0gfTtcclxuICAgICAgICBlbnYuc3RhY2sucHVzaCh7IHZhbHVlOiB2YWx1ZSwgZGlzcG9zZTogZGlzcG9zZSwgYXN5bmM6IGFzeW5jIH0pO1xyXG4gICAgfVxyXG4gICAgZWxzZSBpZiAoYXN5bmMpIHtcclxuICAgICAgICBlbnYuc3RhY2sucHVzaCh7IGFzeW5jOiB0cnVlIH0pO1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIHZhbHVlO1xyXG5cclxufVxyXG5cclxudmFyIF9TdXBwcmVzc2VkRXJyb3IgPSB0eXBlb2YgU3VwcHJlc3NlZEVycm9yID09PSBcImZ1bmN0aW9uXCIgPyBTdXBwcmVzc2VkRXJyb3IgOiBmdW5jdGlvbiAoZXJyb3IsIHN1cHByZXNzZWQsIG1lc3NhZ2UpIHtcclxuICAgIHZhciBlID0gbmV3IEVycm9yKG1lc3NhZ2UpO1xyXG4gICAgcmV0dXJuIGUubmFtZSA9IFwiU3VwcHJlc3NlZEVycm9yXCIsIGUuZXJyb3IgPSBlcnJvciwgZS5zdXBwcmVzc2VkID0gc3VwcHJlc3NlZCwgZTtcclxufTtcclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBfX2Rpc3Bvc2VSZXNvdXJjZXMoZW52KSB7XHJcbiAgICBmdW5jdGlvbiBmYWlsKGUpIHtcclxuICAgICAgICBlbnYuZXJyb3IgPSBlbnYuaGFzRXJyb3IgPyBuZXcgX1N1cHByZXNzZWRFcnJvcihlLCBlbnYuZXJyb3IsIFwiQW4gZXJyb3Igd2FzIHN1cHByZXNzZWQgZHVyaW5nIGRpc3Bvc2FsLlwiKSA6IGU7XHJcbiAgICAgICAgZW52Lmhhc0Vycm9yID0gdHJ1ZTtcclxuICAgIH1cclxuICAgIHZhciByLCBzID0gMDtcclxuICAgIGZ1bmN0aW9uIG5leHQoKSB7XHJcbiAgICAgICAgd2hpbGUgKHIgPSBlbnYuc3RhY2sucG9wKCkpIHtcclxuICAgICAgICAgICAgdHJ5IHtcclxuICAgICAgICAgICAgICAgIGlmICghci5hc3luYyAmJiBzID09PSAxKSByZXR1cm4gcyA9IDAsIGVudi5zdGFjay5wdXNoKHIpLCBQcm9taXNlLnJlc29sdmUoKS50aGVuKG5leHQpO1xyXG4gICAgICAgICAgICAgICAgaWYgKHIuZGlzcG9zZSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciByZXN1bHQgPSByLmRpc3Bvc2UuY2FsbChyLnZhbHVlKTtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoci5hc3luYykgcmV0dXJuIHMgfD0gMiwgUHJvbWlzZS5yZXNvbHZlKHJlc3VsdCkudGhlbihuZXh0LCBmdW5jdGlvbihlKSB7IGZhaWwoZSk7IHJldHVybiBuZXh0KCk7IH0pO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgZWxzZSBzIHw9IDE7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgY2F0Y2ggKGUpIHtcclxuICAgICAgICAgICAgICAgIGZhaWwoZSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKHMgPT09IDEpIHJldHVybiBlbnYuaGFzRXJyb3IgPyBQcm9taXNlLnJlamVjdChlbnYuZXJyb3IpIDogUHJvbWlzZS5yZXNvbHZlKCk7XHJcbiAgICAgICAgaWYgKGVudi5oYXNFcnJvcikgdGhyb3cgZW52LmVycm9yO1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIG5leHQoKTtcclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIF9fcmV3cml0ZVJlbGF0aXZlSW1wb3J0RXh0ZW5zaW9uKHBhdGgsIHByZXNlcnZlSnN4KSB7XHJcbiAgICBpZiAodHlwZW9mIHBhdGggPT09IFwic3RyaW5nXCIgJiYgL15cXC5cXC4/XFwvLy50ZXN0KHBhdGgpKSB7XHJcbiAgICAgICAgcmV0dXJuIHBhdGgucmVwbGFjZSgvXFwuKHRzeCkkfCgoPzpcXC5kKT8pKCg/OlxcLlteLi9dKz8pPylcXC4oW2NtXT8pdHMkL2ksIGZ1bmN0aW9uIChtLCB0c3gsIGQsIGV4dCwgY20pIHtcclxuICAgICAgICAgICAgcmV0dXJuIHRzeCA/IHByZXNlcnZlSnN4ID8gXCIuanN4XCIgOiBcIi5qc1wiIDogZCAmJiAoIWV4dCB8fCAhY20pID8gbSA6IChkICsgZXh0ICsgXCIuXCIgKyBjbS50b0xvd2VyQ2FzZSgpICsgXCJqc1wiKTtcclxuICAgICAgICB9KTtcclxuICAgIH1cclxuICAgIHJldHVybiBwYXRoO1xyXG59XHJcblxyXG5leHBvcnQgZGVmYXVsdCB7XHJcbiAgICBfX2V4dGVuZHM6IF9fZXh0ZW5kcyxcclxuICAgIF9fYXNzaWduOiBfX2Fzc2lnbixcclxuICAgIF9fcmVzdDogX19yZXN0LFxyXG4gICAgX19kZWNvcmF0ZTogX19kZWNvcmF0ZSxcclxuICAgIF9fcGFyYW06IF9fcGFyYW0sXHJcbiAgICBfX2VzRGVjb3JhdGU6IF9fZXNEZWNvcmF0ZSxcclxuICAgIF9fcnVuSW5pdGlhbGl6ZXJzOiBfX3J1bkluaXRpYWxpemVycyxcclxuICAgIF9fcHJvcEtleTogX19wcm9wS2V5LFxyXG4gICAgX19zZXRGdW5jdGlvbk5hbWU6IF9fc2V0RnVuY3Rpb25OYW1lLFxyXG4gICAgX19tZXRhZGF0YTogX19tZXRhZGF0YSxcclxuICAgIF9fYXdhaXRlcjogX19hd2FpdGVyLFxyXG4gICAgX19nZW5lcmF0b3I6IF9fZ2VuZXJhdG9yLFxyXG4gICAgX19jcmVhdGVCaW5kaW5nOiBfX2NyZWF0ZUJpbmRpbmcsXHJcbiAgICBfX2V4cG9ydFN0YXI6IF9fZXhwb3J0U3RhcixcclxuICAgIF9fdmFsdWVzOiBfX3ZhbHVlcyxcclxuICAgIF9fcmVhZDogX19yZWFkLFxyXG4gICAgX19zcHJlYWQ6IF9fc3ByZWFkLFxyXG4gICAgX19zcHJlYWRBcnJheXM6IF9fc3ByZWFkQXJyYXlzLFxyXG4gICAgX19zcHJlYWRBcnJheTogX19zcHJlYWRBcnJheSxcclxuICAgIF9fYXdhaXQ6IF9fYXdhaXQsXHJcbiAgICBfX2FzeW5jR2VuZXJhdG9yOiBfX2FzeW5jR2VuZXJhdG9yLFxyXG4gICAgX19hc3luY0RlbGVnYXRvcjogX19hc3luY0RlbGVnYXRvcixcclxuICAgIF9fYXN5bmNWYWx1ZXM6IF9fYXN5bmNWYWx1ZXMsXHJcbiAgICBfX21ha2VUZW1wbGF0ZU9iamVjdDogX19tYWtlVGVtcGxhdGVPYmplY3QsXHJcbiAgICBfX2ltcG9ydFN0YXI6IF9faW1wb3J0U3RhcixcclxuICAgIF9faW1wb3J0RGVmYXVsdDogX19pbXBvcnREZWZhdWx0LFxyXG4gICAgX19jbGFzc1ByaXZhdGVGaWVsZEdldDogX19jbGFzc1ByaXZhdGVGaWVsZEdldCxcclxuICAgIF9fY2xhc3NQcml2YXRlRmllbGRTZXQ6IF9fY2xhc3NQcml2YXRlRmllbGRTZXQsXHJcbiAgICBfX2NsYXNzUHJpdmF0ZUZpZWxkSW46IF9fY2xhc3NQcml2YXRlRmllbGRJbixcclxuICAgIF9fYWRkRGlzcG9zYWJsZVJlc291cmNlOiBfX2FkZERpc3Bvc2FibGVSZXNvdXJjZSxcclxuICAgIF9fZGlzcG9zZVJlc291cmNlczogX19kaXNwb3NlUmVzb3VyY2VzLFxyXG4gICAgX19yZXdyaXRlUmVsYXRpdmVJbXBvcnRFeHRlbnNpb246IF9fcmV3cml0ZVJlbGF0aXZlSW1wb3J0RXh0ZW5zaW9uLFxyXG59O1xyXG4iLCJpbXBvcnQgeyBcbiAgQXBwLCBcbiAgRWRpdG9yLCBcbiAgTWFya2Rvd25WaWV3LCBcbiAgTW9kYWwsIFxuICBOb3RpY2UsIFxuICBQbHVnaW4sIFxuICBQbHVnaW5TZXR0aW5nVGFiLFxuICBTZXR0aW5nLFxuICBURmlsZSwgXG4gIEZyb250TWF0dGVyQ2FjaGUsIFxuICBwYXJzZVlhbWwsXG4gIHN0cmluZ2lmeVlhbWwsXG4gIFdvcmtzcGFjZUxlYWZcbn0gZnJvbSAnb2JzaWRpYW4nO1xuXG5pbnRlcmZhY2UgS2FuYmFuU3RhdHVzVXBkYXRlclNldHRpbmdzIHtcbiAgc3RhdHVzUHJvcGVydHlOYW1lOiBzdHJpbmc7XG4gIHNob3dOb3RpZmljYXRpb25zOiBib29sZWFuO1xuICBkZWJ1Z01vZGU6IGJvb2xlYW47XG59XG5cbmNvbnN0IERFRkFVTFRfU0VUVElOR1M6IEthbmJhblN0YXR1c1VwZGF0ZXJTZXR0aW5ncyA9IHtcbiAgc3RhdHVzUHJvcGVydHlOYW1lOiAnc3RhdHVzJyxcbiAgc2hvd05vdGlmaWNhdGlvbnM6IHRydWUsXG4gIGRlYnVnTW9kZTogdHJ1ZVxufVxuXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBLYW5iYW5TdGF0dXNVcGRhdGVyUGx1Z2luIGV4dGVuZHMgUGx1Z2luIHtcbiAgc2V0dGluZ3M6IEthbmJhblN0YXR1c1VwZGF0ZXJTZXR0aW5ncztcblxuICAvLyBQcm9jZXNzIGZsYWdzIHRvIGF2b2lkIGluZmluaXRlIGxvb3BzXG4gIHByaXZhdGUgcHJvY2Vzc2luZ011dGF0aW9uOiBib29sZWFuID0gZmFsc2U7XG4gIHByaXZhdGUgcGVuZGluZ0NhcmRVcGRhdGVzOiBNYXA8c3RyaW5nLCB7Y2FyZDogSFRNTEVsZW1lbnQsIGNvbHVtbjogSFRNTEVsZW1lbnR9PiA9IG5ldyBNYXAoKTtcbiAgcHJpdmF0ZSBtdXRhdGlvbkRlYm91bmNlVGltZW91dDogTm9kZUpTLlRpbWVvdXQgPSBudWxsO1xuICBkZWJ1Z0xvZzogYW55O1xuICBzdGF0dXNCYXJJdGVtOiBhbnk7XG5cbiAgYXN5bmMgb25sb2FkKCkge1xuICAgICAgYXdhaXQgdGhpcy5sb2FkU2V0dGluZ3MoKTtcblxuICAgICAgLy8gU2V0IHVwIGRlYnVnIGxvZ2dpbmcgd2l0aCByYXRlIGxpbWl0aW5nXG4gICAgICBsZXQgbGFzdExvZ1RpbWUgPSBEYXRlLm5vdygpO1xuICAgICAgbGV0IGxvZ0NvdW50ID0gMDtcbiAgICAgIHRoaXMuZGVidWdMb2cgPSAobWVzc2FnZTogc3RyaW5nKSA9PiB7XG4gICAgICAgICAgaWYgKHRoaXMuc2V0dGluZ3MuZGVidWdNb2RlKSB7XG4gICAgICAgICAgICAgIC8vIFJhdGUgbGltaXQgbG9ncyB0byBwcmV2ZW50IGNvbnNvbGUgZmxvb2RpbmdcbiAgICAgICAgICAgICAgY29uc3Qgbm93ID0gRGF0ZS5ub3coKTtcbiAgICAgICAgICAgICAgaWYgKG5vdyAtIGxhc3RMb2dUaW1lID4gNTAwMCkge1xuICAgICAgICAgICAgICAgICAgLy8gUmVzZXQgY291bnRlciBhZnRlciA1IHNlY29uZHNcbiAgICAgICAgICAgICAgICAgIGxvZ0NvdW50ID0gMDtcbiAgICAgICAgICAgICAgICAgIGxhc3RMb2dUaW1lID0gbm93O1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIFxuICAgICAgICAgICAgICBpZiAobG9nQ291bnQgPCA1MCkgeyAvLyBMaW1pdCB0byA1MCBsb2dzIHBlciA1IHNlY29uZHNcbiAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKGBbS2FuYmFuIFN0YXR1cyBVcGRhdGVyXSAke21lc3NhZ2V9YCk7XG4gICAgICAgICAgICAgICAgICBsb2dDb3VudCsrO1xuICAgICAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgICAgICBpZiAodGhpcy5zdGF0dXNCYXJJdGVtKSB7XG4gICAgICAgICAgICAgICAgICAgICAgdGhpcy5zdGF0dXNCYXJJdGVtLnNldFRleHQoYFtLU1VdICR7bWVzc2FnZS5zdWJzdHJpbmcoMCwgNDApfSR7bWVzc2FnZS5sZW5ndGggPiA0MCA/ICcuLi4nIDogJyd9YCk7XG4gICAgICAgICAgICAgICAgICAgICAgLy8gUmVzZXQgYWZ0ZXIgNSBzZWNvbmRzXG4gICAgICAgICAgICAgICAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLnN0YXR1c0Jhckl0ZW0pIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuc3RhdHVzQmFySXRlbS5zZXRUZXh0KCdLYW5iYW4gU3RhdHVzIFVwZGF0ZXIgQWN0aXZlJyk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICB9LCA1MDAwKTtcbiAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgfSBlbHNlIGlmIChsb2dDb3VudCA9PT0gNTApIHtcbiAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKGBbS2FuYmFuIFN0YXR1cyBVcGRhdGVyXSBUb28gbWFueSBsb2dzLCB0aHJvdHRsaW5nIHVudGlsICR7bmV3IERhdGUobGFzdExvZ1RpbWUgKyA1MDAwKS50b0xvY2FsZVRpbWVTdHJpbmcoKX1gKTtcbiAgICAgICAgICAgICAgICAgIGxvZ0NvdW50Kys7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICB9O1xuICAgICAgXG4gICAgICAvLyBEaXNwbGF5IHN0YXJ0dXAgbm90aWZpY2F0aW9uXG4gICAgICBuZXcgTm90aWNlKCdLYW5iYW4gU3RhdHVzIFVwZGF0ZXIgcGx1Z2luIGFjdGl2YXRlZCcpO1xuICAgICAgdGhpcy5kZWJ1Z0xvZygnUGx1Z2luIGxvYWRlZCBhbmQgYWN0aXZhdGVkJyk7XG5cbiAgICAgIC8vIEhvb2sgaW50byBET00gZXZlbnRzIHRvIGRldGVjdCBLYW5iYW4gY2FyZCBtb3ZlbWVudHNcbiAgICAgIHRoaXMucmVnaXN0ZXJEb21FdmVudChkb2N1bWVudCwgJ2RyYWdlbmQnLCB0aGlzLmhhbmRsZURyYWdFbmQuYmluZCh0aGlzKSk7XG4gICAgICB0aGlzLmRlYnVnTG9nKCdSZWdpc3RlcmVkIGRyYWcgZXZlbnQgbGlzdGVuZXInKTtcbiAgICAgIFxuICAgICAgLy8gUmVnaXN0ZXIgZm9yIG11dGF0aW9uIGV2ZW50cyB0byBjYXRjaCBub24tZHJhZyB1cGRhdGVzIC0gd2l0aCBvcHRpbWl6YXRpb25zXG4gICAgICBjb25zdCBvYnNlcnZlciA9IG5ldyBNdXRhdGlvbk9ic2VydmVyKChtdXRhdGlvbnMpID0+IHtcbiAgICAgICAgICAvLyBTa2lwIHByb2Nlc3NpbmcgaWYgd2UncmUgYWxyZWFkeSBoYW5kbGluZyBhIG11dGF0aW9uXG4gICAgICAgICAgaWYgKHRoaXMucHJvY2Vzc2luZ011dGF0aW9uKSByZXR1cm47XG4gICAgICAgICAgXG4gICAgICAgICAgLy8gRGVib3VuY2UgbXV0YXRpb24gcHJvY2Vzc2luZyB0byBhdm9pZCB0b28gbWFueSB1cGRhdGVzXG4gICAgICAgICAgaWYgKHRoaXMubXV0YXRpb25EZWJvdW5jZVRpbWVvdXQpIHtcbiAgICAgICAgICAgICAgY2xlYXJUaW1lb3V0KHRoaXMubXV0YXRpb25EZWJvdW5jZVRpbWVvdXQpO1xuICAgICAgICAgIH1cbiAgICAgICAgICBcbiAgICAgICAgICB0aGlzLm11dGF0aW9uRGVib3VuY2VUaW1lb3V0ID0gc2V0VGltZW91dCgoKSA9PiB7XG4gICAgICAgICAgICAgIHRoaXMuaGFuZGxlRE9NTXV0YXRpb25zKG11dGF0aW9ucyk7XG4gICAgICAgICAgICAgIHRoaXMubXV0YXRpb25EZWJvdW5jZVRpbWVvdXQgPSBudWxsO1xuICAgICAgICAgIH0sIDUwMCk7IC8vIFdhaXQgNTAwbXMgYmVmb3JlIHByb2Nlc3NpbmdcbiAgICAgIH0pO1xuICAgICAgXG4gICAgICB0aGlzLmFwcC53b3Jrc3BhY2Uub25MYXlvdXRSZWFkeSgoKSA9PiB7XG4gICAgICAgICAgLy8gRmluZCBLYW5iYW4gYm9hcmQgY29udGFpbmVycyB0byBvYnNlcnZlIG1vcmUgc3BlY2lmaWNhbGx5XG4gICAgICAgICAgY29uc3Qga2FuYmFuQm9hcmRzID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnLmthbmJhbi1wbHVnaW5fX2JvYXJkLCAua2FuYmFuLWJvYXJkJyk7XG4gICAgICAgICAgXG4gICAgICAgICAgaWYgKGthbmJhbkJvYXJkcyAmJiBrYW5iYW5Cb2FyZHMubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgICAvLyBPYnNlcnZlIGVhY2ggS2FuYmFuIGJvYXJkIHNwZWNpZmljYWxseSByYXRoZXIgdGhhbiB0aGUgZW50aXJlIGRvY3VtZW50XG4gICAgICAgICAgICAgIGthbmJhbkJvYXJkcy5mb3JFYWNoKGJvYXJkID0+IHtcbiAgICAgICAgICAgICAgICAgIG9ic2VydmVyLm9ic2VydmUoYm9hcmQsIHsgXG4gICAgICAgICAgICAgICAgICAgICAgY2hpbGRMaXN0OiB0cnVlLCBcbiAgICAgICAgICAgICAgICAgICAgICBzdWJ0cmVlOiB0cnVlLFxuICAgICAgICAgICAgICAgICAgICAgIGF0dHJpYnV0ZXM6IGZhbHNlICAvLyBEb24ndCBuZWVkIGF0dHJpYnV0ZSBjaGFuZ2VzLCBqdXN0IHN0cnVjdHVyZVxuICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICB0aGlzLmRlYnVnTG9nKGBNdXRhdGlvbk9ic2VydmVyIGF0dGFjaGVkIHRvICR7a2FuYmFuQm9hcmRzLmxlbmd0aH0gS2FuYmFuIGJvYXJkc2ApO1xuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgIC8vIExvb2sgZm9yIGVsZW1lbnRzIHdpdGgga2FuYmFuLXBsdWdpbl9fIGluIHRoZWlyIGNsYXNzIG5hbWVzXG4gICAgICAgICAgICAgIGNvbnN0IGthbmJhbkVsZW1lbnRzID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnW2NsYXNzKj1cImthbmJhbi1wbHVnaW5fX1wiXScpO1xuICAgICAgICAgICAgICBpZiAoa2FuYmFuRWxlbWVudHMgJiYga2FuYmFuRWxlbWVudHMubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgICAgICAga2FuYmFuRWxlbWVudHMuZm9yRWFjaChlbCA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgb2JzZXJ2ZXIub2JzZXJ2ZShlbCwge1xuICAgICAgICAgICAgICAgICAgICAgICAgICBjaGlsZExpc3Q6IHRydWUsXG4gICAgICAgICAgICAgICAgICAgICAgICAgIHN1YnRyZWU6IHRydWUsXG4gICAgICAgICAgICAgICAgICAgICAgICAgIGF0dHJpYnV0ZXM6IGZhbHNlXG4gICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgIHRoaXMuZGVidWdMb2coYE11dGF0aW9uT2JzZXJ2ZXIgYXR0YWNoZWQgdG8gJHtrYW5iYW5FbGVtZW50cy5sZW5ndGh9IEthbmJhbiBlbGVtZW50c2ApO1xuICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgLy8gRmFsbGJhY2sgdG8gYSBtb3JlIHRhcmdldGVkIG9ic2VydmF0aW9uIGlmIG5vIGJvYXJkcyBmb3VuZFxuICAgICAgICAgICAgICAgICAgY29uc3Qgd29ya3NwYWNlID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLndvcmtzcGFjZScpO1xuICAgICAgICAgICAgICAgICAgaWYgKHdvcmtzcGFjZSkge1xuICAgICAgICAgICAgICAgICAgICAgIG9ic2VydmVyLm9ic2VydmUod29ya3NwYWNlLCB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgIGNoaWxkTGlzdDogdHJ1ZSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgc3VidHJlZTogdHJ1ZSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgYXR0cmlidXRlczogZmFsc2VcbiAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgICB0aGlzLmRlYnVnTG9nKCdNdXRhdGlvbk9ic2VydmVyIGF0dGFjaGVkIHRvIHdvcmtzcGFjZSAobm8gS2FuYmFuIGJvYXJkcyBmb3VuZCB5ZXQpJyk7XG4gICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgIC8vIExhc3QgcmVzb3J0IC0gb2JzZXJ2ZSBib2R5IHdpdGggbW9yZSByZXN0cmljdGlvbnNcbiAgICAgICAgICAgICAgICAgICAgICBvYnNlcnZlci5vYnNlcnZlKGRvY3VtZW50LmJvZHksIHsgXG4gICAgICAgICAgICAgICAgICAgICAgICAgIGNoaWxkTGlzdDogdHJ1ZSwgXG4gICAgICAgICAgICAgICAgICAgICAgICAgIHN1YnRyZWU6IHRydWUsXG4gICAgICAgICAgICAgICAgICAgICAgICAgIGF0dHJpYnV0ZXM6IGZhbHNlXG4gICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgICAgdGhpcy5kZWJ1Z0xvZygnTXV0YXRpb25PYnNlcnZlciBhdHRhY2hlZCB0byBkb2N1bWVudCBib2R5IChmYWxsYmFjayBtb2RlKScpO1xuICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICAgIFxuICAgICAgICAgIC8vIFNldCB1cCBhIHBlcmlvZGljIGNoZWNrIGZvciBuZXcgS2FuYmFuIGJvYXJkcyAoaW4gY2FzZSB0aGV5J3JlIGFkZGVkIGxhdGVyKVxuICAgICAgICAgIHNldEludGVydmFsKCgpID0+IHtcbiAgICAgICAgICAgICAgY29uc3QgY3VycmVudEJvYXJkcyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJy5rYW5iYW4tcGx1Z2luX19ib2FyZCcpO1xuICAgICAgICAgICAgICBpZiAoY3VycmVudEJvYXJkcyAmJiBjdXJyZW50Qm9hcmRzLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgICAgICAgIGN1cnJlbnRCb2FyZHMuZm9yRWFjaChib2FyZCA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgaWYgKCFib2FyZC5oYXNBdHRyaWJ1dGUoJ2RhdGEta3N1LW9ic2VydmVkJykpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgb2JzZXJ2ZXIub2JzZXJ2ZShib2FyZCwgeyBcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNoaWxkTGlzdDogdHJ1ZSwgXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdWJ0cmVlOiB0cnVlLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYXR0cmlidXRlczogZmFsc2VcbiAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgIGJvYXJkLnNldEF0dHJpYnV0ZSgnZGF0YS1rc3Utb2JzZXJ2ZWQnLCAndHJ1ZScpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmRlYnVnTG9nKCdBZGRlZCBvYnNlcnZlciB0byBuZXcgS2FuYmFuIGJvYXJkJyk7XG4gICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICB9LCAxMDAwMCk7IC8vIENoZWNrIGV2ZXJ5IDEwIHNlY29uZHNcbiAgICAgIH0pO1xuXG4gICAgICAvLyBBZGQgc2V0dGluZ3MgdGFiXG4gICAgICB0aGlzLmFkZFNldHRpbmdUYWIobmV3IEthbmJhblN0YXR1c1VwZGF0ZXJTZXR0aW5nVGFiKHRoaXMuYXBwLCB0aGlzKSk7XG5cbiAgICAgIC8vIEFkZCBhIHN0YXR1cyBiYXIgaXRlbSB0byBzaG93IHRoZSBwbHVnaW4gaXMgYWN0aXZlXG4gICAgICB0aGlzLnN0YXR1c0Jhckl0ZW0gPSB0aGlzLmFkZFN0YXR1c0Jhckl0ZW0oKTtcbiAgICAgIHRoaXMuc3RhdHVzQmFySXRlbS5zZXRUZXh0KCdLYW5iYW4gU3RhdHVzIFVwZGF0ZXIgQWN0aXZlJyk7XG4gICAgICB0aGlzLnN0YXR1c0Jhckl0ZW0uYWRkQ2xhc3MoJ3BsdWdpbi1rYW5iYW4tc3RhdHVzLXVwZGF0ZXInKTtcbiAgICAgIFxuICAgICAgLy8gQ2hlY2sgaWYgS2FuYmFuIHBsdWdpbiBpcyBsb2FkZWQgLSB1c2luZyBzYWZlciBhcHByb2FjaFxuICAgICAgdHJ5IHtcbiAgICAgICAgICAvLyBAdHMtaWdub3JlIC0gQ2hlY2sgaWYga2FuYmFuIHBsdWdpbiBleGlzdHMgdXNpbmcgYXBwLnBsdWdpbnMgKG1heSBub3QgYmUgaW4gdHlwZSBkZWZpbml0aW9ucylcbiAgICAgICAgICBjb25zdCBrYW5iYW5Mb2FkZWQgPSB0aGlzLmFwcC5wbHVnaW5zICYmIFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIEB0cy1pZ25vcmVcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAoKHRoaXMuYXBwLnBsdWdpbnMucGx1Z2lucyAmJiB0aGlzLmFwcC5wbHVnaW5zLnBsdWdpbnNbJ29ic2lkaWFuLWthbmJhbiddKSB8fCBcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gQHRzLWlnbm9yZVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAodGhpcy5hcHAucGx1Z2lucy5lbmFibGVkUGx1Z2lucyAmJiB0aGlzLmFwcC5wbHVnaW5zLmVuYWJsZWRQbHVnaW5zLmhhcygnb2JzaWRpYW4ta2FuYmFuJykpKTtcbiAgICAgICAgICBcbiAgICAgICAgICBpZiAoIWthbmJhbkxvYWRlZCkge1xuICAgICAgICAgICAgICBuZXcgTm90aWNlKCfimqDvuI8gV2FybmluZzogS2FuYmFuIHBsdWdpbiBtaWdodCBub3QgYmUgZW5hYmxlZC4gS2FuYmFuIFN0YXR1cyBVcGRhdGVyIHJlcXVpcmVzIGl0LicsIDEwMDAwKTtcbiAgICAgICAgICAgICAgdGhpcy5kZWJ1Z0xvZygnV0FSTklORzogS2FuYmFuIHBsdWdpbiBub3QgZGV0ZWN0ZWQhJyk7XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgdGhpcy5kZWJ1Z0xvZygnS2FuYmFuIHBsdWdpbiBkZXRlY3RlZCcpO1xuICAgICAgICAgIH1cbiAgICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgICAgICAvLyBJZiB3ZSBjYW4ndCBkZXRlY3QgaXQsIGp1c3QgbG9nIGFuZCBjb250aW51ZVxuICAgICAgICAgIHRoaXMuZGVidWdMb2coYENvdWxkbid0IHZlcmlmeSBLYW5iYW4gcGx1Z2luOiAke2UubWVzc2FnZX1gKTtcbiAgICAgIH1cbiAgfVxuXG4gIG9udW5sb2FkKCkge1xuICAgICAgdGhpcy5kZWJ1Z0xvZygnUGx1Z2luIHVubG9hZGVkJyk7XG4gICAgICBuZXcgTm90aWNlKCdLYW5iYW4gU3RhdHVzIFVwZGF0ZXIgcGx1Z2luIGRlYWN0aXZhdGVkJyk7XG4gIH1cblxuICBhc3luYyBsb2FkU2V0dGluZ3MoKSB7XG4gICAgICB0aGlzLnNldHRpbmdzID0gT2JqZWN0LmFzc2lnbih7fSwgREVGQVVMVF9TRVRUSU5HUywgYXdhaXQgdGhpcy5sb2FkRGF0YSgpKTtcbiAgfVxuXG4gIGFzeW5jIHNhdmVTZXR0aW5ncygpIHtcbiAgICAgIGF3YWl0IHRoaXMuc2F2ZURhdGEodGhpcy5zZXR0aW5ncyk7XG4gIH1cblxuICBoYW5kbGVEcmFnRW5kKGV2dDogRHJhZ0V2ZW50KSB7XG4gICAgICAvLyBDaGVjayBpZiB0aGlzIHdhcyBhIEthbmJhbi1yZWxhdGVkIGVsZW1lbnQgYmVpbmcgZHJhZ2dlZFxuICAgICAgY29uc3QgdGFyZ2V0ID0gZXZ0LnRhcmdldCBhcyBIVE1MRWxlbWVudDtcbiAgICAgIGlmICghdGFyZ2V0KSB7XG4gICAgICAgICAgdGhpcy5kZWJ1Z0xvZygnRHJhZyBldmVudCBoYWQgbm8gdGFyZ2V0Jyk7XG4gICAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuICAgICAgXG4gICAgICB0aGlzLmRlYnVnTG9nKGBEcmFnIGV2ZW50IGRldGVjdGVkIG9uIGVsZW1lbnQ6ICR7dGFyZ2V0LnRhZ05hbWV9IHdpdGggY2xhc3MgJHt0YXJnZXQuY2xhc3NOYW1lfWApO1xuICAgICAgXG4gICAgICAvLyBEZXRlcm1pbmUgaWYgdGhpcyBpcyBhIEthbmJhbi1yZWxhdGVkIGRyYWdcbiAgICAgIGNvbnN0IGlzS2FuYmFuRWxlbWVudCA9IFxuICAgICAgICAgIHRhcmdldC5jbGFzc05hbWUuaW5jbHVkZXMoJ2thbmJhbi1wbHVnaW5fXycpIHx8XG4gICAgICAgICAgdGFyZ2V0LmNsYXNzTmFtZS5pbmNsdWRlcygnbWFya2Rvd24tcHJldmlldy12aWV3JykgfHxcbiAgICAgICAgICAhIXRhcmdldC5jbG9zZXN0KCdbY2xhc3MqPVwia2FuYmFuLXBsdWdpbl9fXCJdJyk7XG4gICAgICAgICAgXG4gICAgICBpZiAoIWlzS2FuYmFuRWxlbWVudCkge1xuICAgICAgICAgIHRoaXMuZGVidWdMb2coJ05vdCBhIEthbmJhbi1yZWxhdGVkIGRyYWcgZXZlbnQnKTtcbiAgICAgICAgICByZXR1cm47XG4gICAgICB9XG4gICAgICBcbiAgICAgIHRoaXMuZGVidWdMb2coJ0thbmJhbi1yZWxhdGVkIGRyYWcgZGV0ZWN0ZWQnKTtcbiAgICAgIFxuICAgICAgLy8gR2V0IHRoZSBpdGVtIHRoYXQgd2FzIGRyYWdnZWQgKGNvdWxkIGJlIGEgdGFzayBpdGVtIG9yIGxpc3QgaXRlbSlcbiAgICAgIGNvbnN0IGRyYWdnZWRJdGVtID0gdGFyZ2V0LmNsb3Nlc3QoJ2xpJykgfHwgdGFyZ2V0LmNsb3Nlc3QoJy50YXNrLWxpc3QtaXRlbScpIHx8IHRhcmdldDtcbiAgICAgIGlmICghZHJhZ2dlZEl0ZW0pIHtcbiAgICAgICAgICB0aGlzLmRlYnVnTG9nKCdDb3VsZCBub3QgaWRlbnRpZnkgdGhlIGRyYWdnZWQgaXRlbScpO1xuICAgICAgICAgIHJldHVybjtcbiAgICAgIH1cbiAgICAgIFxuICAgICAgLy8gRmluZCB3aGF0IGNvbHVtbiBpdCB3YXMgZHJvcHBlZCBpbnRvXG4gICAgICBjb25zdCBjb2x1bW4gPSB0aGlzLmZpbmRLYW5iYW5Db2x1bW4oZHJhZ2dlZEl0ZW0gYXMgSFRNTEVsZW1lbnQpO1xuICAgICAgaWYgKCFjb2x1bW4pIHtcbiAgICAgICAgICB0aGlzLmRlYnVnTG9nKCdDb3VsZCBub3QgZGV0ZXJtaW5lIGRlc3RpbmF0aW9uIGNvbHVtbicpO1xuICAgICAgICAgIHJldHVybjtcbiAgICAgIH1cbiAgICAgIFxuICAgICAgdGhpcy5kZWJ1Z0xvZygnRm91bmQgY29sdW1uIGZvciBkcmFnZ2VkIGl0ZW0sIHByb2Nlc3NpbmcgbW92ZW1lbnQnKTtcbiAgICAgIFxuICAgICAgLy8gUHJvY2VzcyB0aGUgY2FyZCBtb3ZlbWVudFxuICAgICAgdGhpcy5wcm9jZXNzQ2FyZE1vdmVtZW50KGRyYWdnZWRJdGVtIGFzIEhUTUxFbGVtZW50LCBjb2x1bW4gYXMgSFRNTEVsZW1lbnQpO1xuICB9XG5cbiAgaGFuZGxlRE9NTXV0YXRpb25zKG11dGF0aW9uczogTXV0YXRpb25SZWNvcmRbXSkge1xuICAgICAgaWYgKHRoaXMucHJvY2Vzc2luZ011dGF0aW9uKSB7XG4gICAgICAgICAgdGhpcy5kZWJ1Z0xvZygnQWxyZWFkeSBwcm9jZXNzaW5nIG11dGF0aW9ucywgc2tpcHBpbmcnKTtcbiAgICAgICAgICByZXR1cm47XG4gICAgICB9XG4gICAgICBcbiAgICAgIC8vIFByb2Nlc3Mgb25seSBhIHNhbXBsZSBvZiBtdXRhdGlvbnMgaWYgdGhlcmUgYXJlIHRvbyBtYW55XG4gICAgICBjb25zdCBtdXRhdGlvbnNUb1Byb2Nlc3MgPSBtdXRhdGlvbnMubGVuZ3RoID4gMTAgPyBcbiAgICAgICAgICBtdXRhdGlvbnMuc2xpY2UoMCwgMTApIDogbXV0YXRpb25zO1xuICAgICAgICAgIFxuICAgICAgdGhpcy5kZWJ1Z0xvZyhgUHJvY2Vzc2luZyAke211dGF0aW9uc1RvUHJvY2Vzcy5sZW5ndGh9IG11dGF0aW9ucyAob2YgJHttdXRhdGlvbnMubGVuZ3RofSB0b3RhbClgKTtcbiAgICAgIFxuICAgICAgLy8gU2V0IGZsYWcgdG8gcHJldmVudCByZWN1cnNpdmUgcHJvY2Vzc2luZ1xuICAgICAgdGhpcy5wcm9jZXNzaW5nTXV0YXRpb24gPSB0cnVlO1xuICAgICAgXG4gICAgICB0cnkge1xuICAgICAgICAgIC8vIENsZWFyIHRoZSBwZW5kaW5nIHVwZGF0ZXMgbWFwXG4gICAgICAgICAgdGhpcy5wZW5kaW5nQ2FyZFVwZGF0ZXMuY2xlYXIoKTtcbiAgICAgICAgICBcbiAgICAgICAgICAvLyBDaGVjayBmb3IgcmVsZXZhbnQgbXV0YXRpb25zIChjYXJkIGJlaW5nIGFkZGVkIHRvIGEgY29sdW1uKVxuICAgICAgICAgIGZvciAoY29uc3QgbXV0YXRpb24gb2YgbXV0YXRpb25zVG9Qcm9jZXNzKSB7XG4gICAgICAgICAgICAgIGlmIChtdXRhdGlvbi50eXBlID09PSAnY2hpbGRMaXN0Jykge1xuICAgICAgICAgICAgICAgICAgLy8gT25seSBsb2cgaWYgdGhlcmUgYXJlIGFjdHVhbGx5IEthbmJhbi1yZWxhdGVkIG5vZGVzXG4gICAgICAgICAgICAgICAgICBsZXQgZm91bmRLYW5iYW5FbGVtZW50cyA9IGZhbHNlO1xuICAgICAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgICAgICBmb3IgKGNvbnN0IG5vZGUgb2YgQXJyYXkuZnJvbShtdXRhdGlvbi5hZGRlZE5vZGVzKSkge1xuICAgICAgICAgICAgICAgICAgICAgIGlmIChub2RlIGluc3RhbmNlb2YgSFRNTEVsZW1lbnQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gTG9nIGFsbCBlbGVtZW50IGNsYXNzZXMgZHVyaW5nIGRlYnVnIHRvIGhlbHAgaWRlbnRpZnkgcGF0dGVybnNcbiAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuc2V0dGluZ3MuZGVidWdNb2RlICYmIG5vZGUuY2xhc3NOYW1lKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmRlYnVnTG9nKGBFbGVtZW50IGNsYXNzZXM6ICR7bm9kZS5jbGFzc05hbWV9YCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgICAgICAgICAgICAgIC8vIENoZWNrIGlmIHRoaXMgaXMgb3IgY29udGFpbnMgS2FuYmFuLXJlbGF0ZWQgZWxlbWVudHNcbiAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgaXNLYW5iYW5FbGVtZW50ID0gXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICBub2RlLmNsYXNzTmFtZS5pbmNsdWRlcygna2FuYmFuLXBsdWdpbl9fJykgfHxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5vZGUuY2xhc3NOYW1lLmluY2x1ZGVzKCdtYXJrZG93bi1wcmV2aWV3LXZpZXcnKSB8fFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgISFub2RlLnF1ZXJ5U2VsZWN0b3IoJ1tjbGFzcyo9XCJrYW5iYW4tcGx1Z2luX19cIl0nKSB8fFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgISFub2RlLmNsb3Nlc3QoJ1tjbGFzcyo9XCJrYW5iYW4tcGx1Z2luX19cIl0nKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoaXNLYW5iYW5FbGVtZW50KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3VuZEthbmJhbkVsZW1lbnRzID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gT25seSBub3cgbG9nIGRldGFpbHNcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuZGVidWdMb2coYFJlbGV2YW50IG11dGF0aW9uOiAke25vZGUudGFnTmFtZX0gd2l0aCBjbGFzcyAke25vZGUuY2xhc3NOYW1lfWApO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBUcnkgdG8gaWRlbnRpZnkgcG90ZW50aWFsIGNhcmQgZWxlbWVudHMgaW4gc2V2ZXJhbCB3YXlzXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBLYW5iYW4gY2FyZHMgbWlnaHQgYmUgbGlzdCBpdGVtcyBpbiB0aGUgbWFya2Rvd25cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGxpc3RJdGVtcyA9IG5vZGUucXVlcnlTZWxlY3RvckFsbCgnbGknKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHRhc2tMaXN0SXRlbXMgPSBub2RlLnF1ZXJ5U2VsZWN0b3JBbGwoJy50YXNrLWxpc3QtaXRlbScpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgZGF0YUl0ZW1zID0gbm9kZS5xdWVyeVNlbGVjdG9yQWxsKCdbZGF0YS1saW5lXScpOyAgLy8gSXRlbXMgd2l0aCBkYXRhLWxpbmUgYXR0cmlidXRlXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHBvdGVudGlhbENhcmRzID0gW1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC4uLkFycmF5LmZyb20obGlzdEl0ZW1zKSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAuLi5BcnJheS5mcm9tKHRhc2tMaXN0SXRlbXMpLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC4uLkFycmF5LmZyb20oZGF0YUl0ZW1zKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHBvdGVudGlhbENhcmRzLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmRlYnVnTG9nKGBGb3VuZCAke3BvdGVudGlhbENhcmRzLmxlbmd0aH0gcG90ZW50aWFsIGNhcmQgZWxlbWVudHNgKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3IgKGNvbnN0IGNhcmQgb2YgcG90ZW50aWFsQ2FyZHMpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gVHJ5IHRvIGZpbmQgdGhlIGNvbHVtbiAtIG1pZ2h0IGJlIGEgcGFyZW50IGVsZW1lbnQgd2l0aCBhIGhlYWRpbmdcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgY29sdW1uID0gdGhpcy5maW5kS2FuYmFuQ29sdW1uKGNhcmQgYXMgSFRNTEVsZW1lbnQpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGNvbHVtbikge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gQ3JlYXRlIGEgdW5pcXVlIElEIGZvciB0aGlzIGNhcmRcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGNhcmRUZXh0ID0gY2FyZC50ZXh0Q29udGVudD8udHJpbSgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgY2FyZElkID0gY2FyZFRleHQ/LnN1YnN0cmluZygwLCA1MCkgfHwgY2FyZC5pZCB8fCAndW5rbm93bic7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuZGVidWdMb2coYEZvdW5kIGNhcmQ6IFwiJHtjYXJkVGV4dD8uc3Vic3RyaW5nKDAsIDMwKX0uLi5cIiBpbiBjb2x1bW5gKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gQWRkIHRvIHBlbmRpbmcgdXBkYXRlc1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5wZW5kaW5nQ2FyZFVwZGF0ZXMuc2V0KGNhcmRJZCwge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhcmQ6IGNhcmQgYXMgSFRNTEVsZW1lbnQsIFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbHVtbjogY29sdW1uXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5kZWJ1Z0xvZygnTm8gcG90ZW50aWFsIGNhcmRzIGZvdW5kIGluIEthbmJhbiBlbGVtZW50Jyk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgICAgIC8vIE9ubHkgbG9nIGZvciBtdXRhdGlvbnMgd2l0aCBLYW5iYW4gZWxlbWVudHNcbiAgICAgICAgICAgICAgICAgIGlmIChmb3VuZEthbmJhbkVsZW1lbnRzKSB7XG4gICAgICAgICAgICAgICAgICAgICAgdGhpcy5kZWJ1Z0xvZyhgUHJvY2Vzc2VkIG11dGF0aW9uIHdpdGggJHttdXRhdGlvbi5hZGRlZE5vZGVzLmxlbmd0aH0gbm9kZXNgKTtcbiAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgICBcbiAgICAgICAgICAvLyBQcm9jZXNzIGFsbCBwZW5kaW5nIHVwZGF0ZXNcbiAgICAgICAgICBpZiAodGhpcy5wZW5kaW5nQ2FyZFVwZGF0ZXMuc2l6ZSA+IDApIHtcbiAgICAgICAgICAgICAgdGhpcy5kZWJ1Z0xvZyhgUHJvY2Vzc2luZyAke3RoaXMucGVuZGluZ0NhcmRVcGRhdGVzLnNpemV9IGNhcmQgdXBkYXRlc2ApO1xuICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgLy8gUHJvY2VzcyBlYWNoIGNhcmQgdXBkYXRlICh3aXRoIGEgc2xpZ2h0IGRlbGF5IGJldHdlZW4gdGhlbSB0byBhdm9pZCBvdmVybG9hZGluZylcbiAgICAgICAgICAgICAgbGV0IGluZGV4ID0gMDtcbiAgICAgICAgICAgICAgZm9yIChjb25zdCBbY2FyZElkLCB7Y2FyZCwgY29sdW1ufV0gb2YgdGhpcy5wZW5kaW5nQ2FyZFVwZGF0ZXMuZW50cmllcygpKSB7XG4gICAgICAgICAgICAgICAgICAvLyBTdGFnZ2VyIHByb2Nlc3NpbmcgdG8gYXZvaWQgdG9vIG11Y2ggYXQgb25jZVxuICAgICAgICAgICAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgdGhpcy5wcm9jZXNzQ2FyZE1vdmVtZW50KGNhcmQsIGNvbHVtbik7XG4gICAgICAgICAgICAgICAgICB9LCBpbmRleCAqIDEwMCk7IC8vIDEwMG1zIGJldHdlZW4gZWFjaCBjYXJkXG4gICAgICAgICAgICAgICAgICBpbmRleCsrO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgfSBjYXRjaCAoZSkge1xuICAgICAgICAgIHRoaXMuZGVidWdMb2coYEVycm9yIHByb2Nlc3NpbmcgbXV0YXRpb25zOiAke2UubWVzc2FnZX1gKTtcbiAgICAgIH0gZmluYWxseSB7XG4gICAgICAgICAgLy8gQ2xlYXIgdGhlIGZsYWcgd2hlbiBkb25lXG4gICAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7XG4gICAgICAgICAgICAgIHRoaXMucHJvY2Vzc2luZ011dGF0aW9uID0gZmFsc2U7XG4gICAgICAgICAgICAgIHRoaXMuZGVidWdMb2coJ011dGF0aW9uIHByb2Nlc3NpbmcgY29tcGxldGUnKTtcbiAgICAgICAgICB9LCAxMDAwKTsgLy8gRW5zdXJlIGEgbWluaW11bSBjb29sLWRvd24gcGVyaW9kIGJldHdlZW4gbXV0YXRpb24gcHJvY2Vzc2luZ1xuICAgICAgfVxuICB9XG4gIFxuICAvLyBOZXcgaGVscGVyIG1ldGhvZCB0byBmaW5kIHRoZSBLYW5iYW4gY29sdW1uIGZvciBhIGNhcmRcbiAgZmluZEthbmJhbkNvbHVtbihjYXJkOiBIVE1MRWxlbWVudCk6IEhUTUxFbGVtZW50IHwgbnVsbCB7XG4gICAgICAvLyBUcnkgc2V2ZXJhbCBzdHJhdGVnaWVzIHRvIGZpbmQgdGhlIGNvbHVtblxuICAgICAgXG4gICAgICAvLyAxLiBMb29rIGZvciBoZWFkaW5nIGVsZW1lbnRzIHRoYXQgbWlnaHQgYmUgY29sdW1uIGhlYWRlcnNcbiAgICAgIGxldCBjdXJyZW50ID0gY2FyZDtcbiAgICAgIHdoaWxlIChjdXJyZW50ICYmIGN1cnJlbnQudGFnTmFtZSAhPT0gJ0JPRFknKSB7XG4gICAgICAgICAgLy8gQ2hlY2sgaWYgdGhpcyBlbGVtZW50IGhhcyBhIGhlYWRpbmcgYXMgYSBwcmV2aW91cyBzaWJsaW5nIG9yIGNoaWxkXG4gICAgICAgICAgY29uc3QgaGVhZGluZyA9IGN1cnJlbnQucXVlcnlTZWxlY3RvcignaDEsIGgyLCBoMywgaDQsIGg1LCBoNicpIHx8IFxuICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuZmluZFByZXZpb3VzSGVhZGluZyhjdXJyZW50KTtcbiAgICAgICAgICBcbiAgICAgICAgICBpZiAoaGVhZGluZykge1xuICAgICAgICAgICAgICB0aGlzLmRlYnVnTG9nKGBGb3VuZCBjb2x1bW4gaGVhZGluZzogXCIke2hlYWRpbmcudGV4dENvbnRlbnR9XCJgKTtcbiAgICAgICAgICAgICAgcmV0dXJuIGN1cnJlbnQ7XG4gICAgICAgICAgfVxuICAgICAgICAgIFxuICAgICAgICAgIGN1cnJlbnQgPSBjdXJyZW50LnBhcmVudEVsZW1lbnQ7XG4gICAgICB9XG4gICAgICBcbiAgICAgIC8vIDIuIFRyeSB0byBmaW5kIGNvbHVtbiBiYXNlZCBvbiBzdHJ1Y3R1cmUgLSBsb29rIGZvciBjb250YWluZXIgZGl2c1xuICAgICAgY29uc3QgY29udGFpbmVyRGl2ID0gY2FyZC5jbG9zZXN0KCcubWFya2Rvd24tcHJldmlldy1zZWN0aW9uJyk7XG4gICAgICBpZiAoY29udGFpbmVyRGl2KSB7XG4gICAgICAgICAgcmV0dXJuIGNvbnRhaW5lckRpdiBhcyBIVE1MRWxlbWVudDtcbiAgICAgIH1cbiAgICAgIFxuICAgICAgLy8gMy4gSWYgd2UgcmVhbGx5IGNhbid0IGZpbmQgYW55dGhpbmcsIHVzZSB0aGUgcGFyZW50IG9mIHRoZSBjYXJkXG4gICAgICByZXR1cm4gY2FyZC5wYXJlbnRFbGVtZW50O1xuICB9XG4gIFxuICAvLyBIZWxwZXIgdG8gZmluZCB0aGUgcHJldmlvdXMgaGVhZGluZyBlbGVtZW50XG4gIGZpbmRQcmV2aW91c0hlYWRpbmcoZWxlbWVudDogSFRNTEVsZW1lbnQpOiBIVE1MRWxlbWVudCB8IG51bGwge1xuICAgICAgbGV0IHByZXZpb3VzID0gZWxlbWVudC5wcmV2aW91c0VsZW1lbnRTaWJsaW5nO1xuICAgICAgd2hpbGUgKHByZXZpb3VzKSB7XG4gICAgICAgICAgaWYgKHByZXZpb3VzLm1hdGNoZXMoJ2gxLCBoMiwgaDMsIGg0LCBoNSwgaDYnKSkge1xuICAgICAgICAgICAgICByZXR1cm4gcHJldmlvdXMgYXMgSFRNTEVsZW1lbnQ7XG4gICAgICAgICAgfVxuICAgICAgICAgIFxuICAgICAgICAgIC8vIEFsc28gY2hlY2sgY2hpbGRyZW4gb2YgcHJldmlvdXMgc2libGluZ3MgKG5lc3RlZCBoZWFkaW5ncylcbiAgICAgICAgICBjb25zdCBuZXN0ZWRIZWFkaW5nID0gcHJldmlvdXMucXVlcnlTZWxlY3RvcignaDEsIGgyLCBoMywgaDQsIGg1LCBoNicpO1xuICAgICAgICAgIGlmIChuZXN0ZWRIZWFkaW5nKSB7XG4gICAgICAgICAgICAgIHJldHVybiBuZXN0ZWRIZWFkaW5nIGFzIEhUTUxFbGVtZW50O1xuICAgICAgICAgIH1cbiAgICAgICAgICBcbiAgICAgICAgICBwcmV2aW91cyA9IHByZXZpb3VzLnByZXZpb3VzRWxlbWVudFNpYmxpbmc7XG4gICAgICB9XG4gICAgICByZXR1cm4gbnVsbDtcbiAgfVxuXG4gIHByb2Nlc3NDYXJkTW92ZW1lbnQoY2FyZDogSFRNTEVsZW1lbnQsIGNvbHVtbjogSFRNTEVsZW1lbnQpIHtcbiAgICAgIC8vIFRyeSB0byBkZXRlcm1pbmUgdGhlIGNvbHVtbiBuYW1lIChuZXcgc3RhdHVzKSBmcm9tIGhlYWRpbmcgZWxlbWVudHNcbiAgICAgIGxldCBjb2x1bW5IZWFkZXIgPSBjb2x1bW4ucXVlcnlTZWxlY3RvcignaDEsIGgyLCBoMywgaDQsIGg1LCBoNicpO1xuICAgICAgaWYgKCFjb2x1bW5IZWFkZXIpIHtcbiAgICAgICAgICAvLyBJZiBubyBoZWFkaW5nIGZvdW5kIGluIHRoZSBjb2x1bW4sIHRyeSB0byBmaW5kIGl0IGFib3ZlXG4gICAgICAgICAgY29sdW1uSGVhZGVyID0gdGhpcy5maW5kUHJldmlvdXNIZWFkaW5nKGNvbHVtbik7XG4gICAgICB9XG4gICAgICBcbiAgICAgIGlmICghY29sdW1uSGVhZGVyKSB7XG4gICAgICAgICAgdGhpcy5kZWJ1Z0xvZygnQ291bGQgbm90IGZpbmQgY29sdW1uIGhlYWRlciBlbGVtZW50Jyk7XG4gICAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuICAgICAgXG4gICAgICBjb25zdCBuZXdTdGF0dXMgPSBjb2x1bW5IZWFkZXIudGV4dENvbnRlbnQudHJpbSgpO1xuICAgICAgdGhpcy5kZWJ1Z0xvZyhgQ29sdW1uIG5hbWUgKG5ldyBzdGF0dXMpOiBcIiR7bmV3U3RhdHVzfVwiYCk7XG4gICAgICBcbiAgICAgIC8vIEdldCB0aGUgY2FyZCBjb250ZW50IGFuZCBsb29rIGZvciBsaW5rc1xuICAgICAgY29uc3QgY2FyZENvbnRlbnQgPSBjYXJkLnRleHRDb250ZW50IHx8ICcnO1xuICAgICAgdGhpcy5kZWJ1Z0xvZyhgQ2FyZCBjb250ZW50OiBcIiR7Y2FyZENvbnRlbnQuc3Vic3RyaW5nKDAsIDUwKX0ke2NhcmRDb250ZW50Lmxlbmd0aCA+IDUwID8gJy4uLicgOiAnJ31cImApO1xuICAgICAgXG4gICAgICAvLyBUcnkgdG8gZXh0cmFjdCBsaW5rcyBmcm9tIHRoZSBjYXJkIGluIG11bHRpcGxlIHdheXNcbiAgICAgIGxldCBmb3VuZExpbmsgPSBmYWxzZTtcbiAgICAgIFxuICAgICAgLy8gMS4gRmlyc3QgbG9vayBmb3Igd2lraS1saW5rcyBbW0xpbmtdXSBvciBbW0xpbmt8RGlzcGxheSBUZXh0XV1cbiAgICAgIGNvbnN0IHdpa2lMaW5rTWF0Y2ggPSBjYXJkQ29udGVudC5tYXRjaCgvXFxbXFxbKC4qPykoPzpcXHwuKj8pP1xcXVxcXS8pO1xuICAgICAgaWYgKHdpa2lMaW5rTWF0Y2ggJiYgd2lraUxpbmtNYXRjaFsxXSkge1xuICAgICAgICAgIGNvbnN0IGxpbmtQYXRoID0gd2lraUxpbmtNYXRjaFsxXS50cmltKCk7XG4gICAgICAgICAgdGhpcy5kZWJ1Z0xvZyhgRm91bmQgd2lraS1saW5rIHRvOiBcIiR7bGlua1BhdGh9XCJgKTtcbiAgICAgICAgICBcbiAgICAgICAgICAvLyBTaG93IHZpc3VhbCBjb25maXJtYXRpb24gdGhhdCB3ZSdyZSB1cGRhdGluZ1xuICAgICAgICAgIG5ldyBOb3RpY2UoYFVwZGF0aW5nICR7dGhpcy5zZXR0aW5ncy5zdGF0dXNQcm9wZXJ0eU5hbWV9IHRvIFwiJHtuZXdTdGF0dXN9XCIgZm9yIFwiJHtsaW5rUGF0aH1cIi4uLmAsIDIwMDApO1xuICAgICAgICAgIFxuICAgICAgICAgIHRoaXMudXBkYXRlTGlua2VkTm90ZVN0YXR1cyhsaW5rUGF0aCwgbmV3U3RhdHVzKTtcbiAgICAgICAgICBmb3VuZExpbmsgPSB0cnVlO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAvLyAyLiBMb29rIGZvciByZWd1bGFyIGxpbmtzIG9yIGVtYmVkZGVkIGxpbmtzIGluIHRoZSBIVE1MXG4gICAgICAgICAgY29uc3QgbGlua0VsZW1lbnQgPSBjYXJkLnF1ZXJ5U2VsZWN0b3IoJ2EnKTtcbiAgICAgICAgICBpZiAobGlua0VsZW1lbnQpIHtcbiAgICAgICAgICAgICAgY29uc3QgaHJlZiA9IGxpbmtFbGVtZW50LmdldEF0dHJpYnV0ZSgnaHJlZicpO1xuICAgICAgICAgICAgICBpZiAoaHJlZiAmJiBocmVmLnN0YXJ0c1dpdGgoJ29ic2lkaWFuOi8vJykpIHtcbiAgICAgICAgICAgICAgICAgIC8vIEV4dHJhY3QgdGhlIG5vdGUgcGF0aCBmcm9tIG9ic2lkaWFuOi8vIFVSTFxuICAgICAgICAgICAgICAgICAgY29uc3QgbGlua1BhdGggPSBkZWNvZGVVUklDb21wb25lbnQoaHJlZi5yZXBsYWNlKCdvYnNpZGlhbjovL29wZW4/dmF1bHQ9JywgJycpLnNwbGl0KCcmZmlsZT0nKVsxXSB8fCAnJyk7XG4gICAgICAgICAgICAgICAgICBpZiAobGlua1BhdGgpIHtcbiAgICAgICAgICAgICAgICAgICAgICB0aGlzLmRlYnVnTG9nKGBGb3VuZCBvYnNpZGlhbiBsaW5rIHRvOiBcIiR7bGlua1BhdGh9XCJgKTtcbiAgICAgICAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgICAgICAgICAvLyBTaG93IHZpc3VhbCBjb25maXJtYXRpb24gdGhhdCB3ZSdyZSB1cGRhdGluZ1xuICAgICAgICAgICAgICAgICAgICAgIG5ldyBOb3RpY2UoYFVwZGF0aW5nICR7dGhpcy5zZXR0aW5ncy5zdGF0dXNQcm9wZXJ0eU5hbWV9IHRvIFwiJHtuZXdTdGF0dXN9XCIgZm9yIFwiJHtsaW5rUGF0aH1cIi4uLmAsIDIwMDApO1xuICAgICAgICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgICAgICAgIHRoaXMudXBkYXRlTGlua2VkTm90ZVN0YXR1cyhsaW5rUGF0aCwgbmV3U3RhdHVzKTtcbiAgICAgICAgICAgICAgICAgICAgICBmb3VuZExpbmsgPSB0cnVlO1xuICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgfVxuICAgICAgXG4gICAgICBpZiAoIWZvdW5kTGluaykge1xuICAgICAgICAgIHRoaXMuZGVidWdMb2coYE5vIGxpbmsgZm91bmQgaW4gY2FyZDogJHtjYXJkQ29udGVudH1gKTtcbiAgICAgICAgICBuZXcgTm90aWNlKCfimqDvuI8gTm8gbGluayBmb3VuZCBpbiBLYW5iYW4gY2FyZCcsIDMwMDApO1xuICAgICAgfVxuICB9XG5cbiAgYXN5bmMgdXBkYXRlTGlua2VkTm90ZVN0YXR1cyhsaW5rUGF0aDogc3RyaW5nLCBuZXdTdGF0dXM6IHN0cmluZykge1xuICAgICAgLy8gRmluZCB0aGUgbGlua2VkIGZpbGVcbiAgICAgIGNvbnN0IGZpbGUgPSB0aGlzLmFwcC5tZXRhZGF0YUNhY2hlLmdldEZpcnN0TGlua3BhdGhEZXN0KGxpbmtQYXRoLCAnJyk7XG4gICAgICBcbiAgICAgIGlmICghZmlsZSkge1xuICAgICAgICAgIHRoaXMuZGVidWdMb2coYExpbmtlZCBmaWxlIG5vdCBmb3VuZDogJHtsaW5rUGF0aH1gKTtcbiAgICAgICAgICBuZXcgTm90aWNlKGDimqDvuI8gRXJyb3I6IEZpbGUgXCIke2xpbmtQYXRofVwiIG5vdCBmb3VuZGAsIDUwMDApO1xuICAgICAgICAgIHJldHVybjtcbiAgICAgIH1cbiAgICAgIFxuICAgICAgdGhpcy5kZWJ1Z0xvZyhgRm91bmQgbGlua2VkIGZpbGU6ICR7ZmlsZS5wYXRofWApO1xuICAgICAgXG4gICAgICB0cnkge1xuICAgICAgICAgIC8vIFJlYWQgdGhlIGZpbGUgY29udGVudFxuICAgICAgICAgIGNvbnN0IGNvbnRlbnQgPSBhd2FpdCB0aGlzLmFwcC52YXVsdC5yZWFkKGZpbGUpO1xuICAgICAgICAgIHRoaXMuZGVidWdMb2coYEZpbGUgY29udGVudCBsb2FkZWQgKCR7Y29udGVudC5sZW5ndGh9IGNoYXJzKWApO1xuICAgICAgICAgIFxuICAgICAgICAgIC8vIENoZWNrIGlmIHRoZSBmaWxlIGhhcyBmcm9udG1hdHRlclxuICAgICAgICAgIGNvbnN0IGZyb250bWF0dGVyUmVnZXggPSAvXi0tLVxcbihbXFxzXFxTXSo/KVxcbi0tLS87XG4gICAgICAgICAgY29uc3QgZnJvbnRtYXR0ZXJNYXRjaCA9IGNvbnRlbnQubWF0Y2goZnJvbnRtYXR0ZXJSZWdleCk7XG4gICAgICAgICAgXG4gICAgICAgICAgbGV0IG5ld0NvbnRlbnQ7XG4gICAgICAgICAgbGV0IG9sZFN0YXR1cyA9ICdub25lJztcbiAgICAgICAgICBsZXQgYWN0aW9uID0gJ2NyZWF0ZWQnO1xuICAgICAgICAgIFxuICAgICAgICAgIGlmIChmcm9udG1hdHRlck1hdGNoKSB7XG4gICAgICAgICAgICAgIHRoaXMuZGVidWdMb2coJ0ZpbGUgaGFzIGZyb250bWF0dGVyJyk7XG4gICAgICAgICAgICAgIC8vIEZpbGUgaGFzIGZyb250bWF0dGVyXG4gICAgICAgICAgICAgIGNvbnN0IGZyb250bWF0dGVyVGV4dCA9IGZyb250bWF0dGVyTWF0Y2hbMV07XG4gICAgICAgICAgICAgIGxldCBmcm9udG1hdHRlck9iajtcbiAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAgICAgICAvLyBUcnkgdG8gcGFyc2UgdGhlIGZyb250bWF0dGVyXG4gICAgICAgICAgICAgICAgICBmcm9udG1hdHRlck9iaiA9IHBhcnNlWWFtbChmcm9udG1hdHRlclRleHQpO1xuICAgICAgICAgICAgICAgICAgdGhpcy5kZWJ1Z0xvZygnRnJvbnRtYXR0ZXIgcGFyc2VkIHN1Y2Nlc3NmdWxseScpO1xuICAgICAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgICAgICAvLyBDaGVjayBpZiBzdGF0dXMgcHJvcGVydHkgYWxyZWFkeSBleGlzdHNcbiAgICAgICAgICAgICAgICAgIGlmIChmcm9udG1hdHRlck9ialt0aGlzLnNldHRpbmdzLnN0YXR1c1Byb3BlcnR5TmFtZV0pIHtcbiAgICAgICAgICAgICAgICAgICAgICBvbGRTdGF0dXMgPSBmcm9udG1hdHRlck9ialt0aGlzLnNldHRpbmdzLnN0YXR1c1Byb3BlcnR5TmFtZV07XG4gICAgICAgICAgICAgICAgICAgICAgYWN0aW9uID0gJ3VwZGF0ZWQnO1xuICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgICAgICAgICAgICAgIHRoaXMuZGVidWdMb2coYEVycm9yIHBhcnNpbmcgZnJvbnRtYXR0ZXI6ICR7ZS5tZXNzYWdlfWApO1xuICAgICAgICAgICAgICAgICAgbmV3IE5vdGljZShg4pqg77iPIFdhcm5pbmc6IEludmFsaWQgZnJvbnRtYXR0ZXIgaW4gJHtmaWxlLmJhc2VuYW1lfSwgY3JlYXRpbmcgbmV3IGZyb250bWF0dGVyYCwgNTAwMCk7XG4gICAgICAgICAgICAgICAgICBmcm9udG1hdHRlck9iaiA9IHt9O1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAvLyBVcGRhdGUgdGhlIHN0YXR1cyBwcm9wZXJ0eVxuICAgICAgICAgICAgICBmcm9udG1hdHRlck9ialt0aGlzLnNldHRpbmdzLnN0YXR1c1Byb3BlcnR5TmFtZV0gPSBuZXdTdGF0dXM7XG4gICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAvLyBHZW5lcmF0ZSB0aGUgbmV3IGZyb250bWF0dGVyIHRleHRcbiAgICAgICAgICAgICAgY29uc3QgbmV3RnJvbnRtYXR0ZXJUZXh0ID0gc3RyaW5naWZ5WWFtbChmcm9udG1hdHRlck9iaik7XG4gICAgICAgICAgICAgIHRoaXMuZGVidWdMb2coJ05ldyBmcm9udG1hdHRlciBnZW5lcmF0ZWQnKTtcbiAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgIC8vIFJlcGxhY2UgdGhlIGZyb250bWF0dGVyIGluIHRoZSBjb250ZW50XG4gICAgICAgICAgICAgIG5ld0NvbnRlbnQgPSBjb250ZW50LnJlcGxhY2UoZnJvbnRtYXR0ZXJSZWdleCwgYC0tLVxcbiR7bmV3RnJvbnRtYXR0ZXJUZXh0fS0tLWApO1xuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgIHRoaXMuZGVidWdMb2coJ0ZpbGUgaGFzIG5vIGZyb250bWF0dGVyLCBjcmVhdGluZyBuZXcgZnJvbnRtYXR0ZXInKTtcbiAgICAgICAgICAgICAgLy8gRmlsZSBoYXMgbm8gZnJvbnRtYXR0ZXIsIGNyZWF0ZSBpdFxuICAgICAgICAgICAgICBjb25zdCBmcm9udG1hdHRlck9iaiA9IHtcbiAgICAgICAgICAgICAgICAgIFt0aGlzLnNldHRpbmdzLnN0YXR1c1Byb3BlcnR5TmFtZV06IG5ld1N0YXR1c1xuICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICBjb25zdCBmcm9udG1hdHRlclRleHQgPSBzdHJpbmdpZnlZYW1sKGZyb250bWF0dGVyT2JqKTtcbiAgICAgICAgICAgICAgbmV3Q29udGVudCA9IGAtLS1cXG4ke2Zyb250bWF0dGVyVGV4dH0tLS1cXG5cXG4ke2NvbnRlbnR9YDtcbiAgICAgICAgICB9XG4gICAgICAgICAgXG4gICAgICAgICAgLy8gU2F2ZSB0aGUgbW9kaWZpZWQgY29udGVudFxuICAgICAgICAgIGF3YWl0IHRoaXMuYXBwLnZhdWx0Lm1vZGlmeShmaWxlLCBuZXdDb250ZW50KTtcbiAgICAgICAgICB0aGlzLmRlYnVnTG9nKCdGaWxlIG1vZGlmaWVkIHN1Y2Nlc3NmdWxseScpO1xuICAgICAgICAgIFxuICAgICAgICAgIC8vIFNob3cgbm90aWZpY2F0aW9uIHdpdGggbW9yZSBkZXRhaWxzXG4gICAgICAgICAgY29uc3QgYmFubmVyID0gY3JlYXRlRnJhZ21lbnQoZWwgPT4ge1xuICAgICAgICAgICAgICBlbC5jcmVhdGVEaXYoeyBcbiAgICAgICAgICAgICAgICAgIHRleHQ6IGDinIUgJHt0aGlzLnNldHRpbmdzLnN0YXR1c1Byb3BlcnR5TmFtZX0gJHthY3Rpb259OmAsXG4gICAgICAgICAgICAgICAgICBjbHM6ICdzdGF0dXMtdXBkYXRlZC1iYW5uZXItdGl0bGUnXG4gICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICBlbC5jcmVhdGVEaXYoe1xuICAgICAgICAgICAgICAgICAgY2xzOiAnc3RhdHVzLXVwZGF0ZWQtYmFubmVyLWRldGFpbHMnXG4gICAgICAgICAgICAgIH0sIGRpdiA9PiB7XG4gICAgICAgICAgICAgICAgICBkaXYuY3JlYXRlU3Bhbih7IHRleHQ6ICdGaWxlOiAnIH0pO1xuICAgICAgICAgICAgICAgICAgZGl2LmNyZWF0ZVNwYW4oeyBcbiAgICAgICAgICAgICAgICAgICAgICB0ZXh0OiBmaWxlLmJhc2VuYW1lLFxuICAgICAgICAgICAgICAgICAgICAgIGNsczogJ3N0YXR1cy11cGRhdGVkLWZpbGVuYW1lJ1xuICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICBkaXYuY3JlYXRlRWwoJ2JyJyk7XG4gICAgICAgICAgICAgICAgICBpZiAoYWN0aW9uID09PSAndXBkYXRlZCcpIHtcbiAgICAgICAgICAgICAgICAgICAgICBkaXYuY3JlYXRlU3Bhbih7IHRleHQ6ICdDaGFuZ2VkIGZyb206ICcgfSk7XG4gICAgICAgICAgICAgICAgICAgICAgZGl2LmNyZWF0ZVNwYW4oeyBcbiAgICAgICAgICAgICAgICAgICAgICAgICAgdGV4dDogYFwiJHtvbGRTdGF0dXN9XCJgLFxuICAgICAgICAgICAgICAgICAgICAgICAgICBjbHM6ICdzdGF0dXMtdXBkYXRlZC1vbGQtdmFsdWUnXG4gICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgICAgZGl2LmNyZWF0ZUVsKCdicicpO1xuICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgZGl2LmNyZWF0ZVNwYW4oeyB0ZXh0OiAnTmV3IHZhbHVlOiAnIH0pO1xuICAgICAgICAgICAgICAgICAgZGl2LmNyZWF0ZVNwYW4oeyBcbiAgICAgICAgICAgICAgICAgICAgICB0ZXh0OiBgXCIke25ld1N0YXR1c31cImAsXG4gICAgICAgICAgICAgICAgICAgICAgY2xzOiAnc3RhdHVzLXVwZGF0ZWQtbmV3LXZhbHVlJ1xuICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgIH0pO1xuICAgICAgICAgIH0pO1xuICAgICAgICAgIFxuICAgICAgICAgIC8vIEFsd2F5cyBzaG93IHRoZSBkZXRhaWxlZCBiYW5uZXJcbiAgICAgICAgICBuZXcgTm90aWNlKGJhbm5lciwgNTAwMCk7XG4gICAgICAgICAgXG4gICAgICAgICAgLy8gVXBkYXRlIHN0YXR1cyBiYXJcbiAgICAgICAgICB0aGlzLnN0YXR1c0Jhckl0ZW0uc2V0VGV4dChgVXBkYXRlZDogJHtmaWxlLmJhc2VuYW1lfSDihpIgJHtuZXdTdGF0dXN9YCk7XG4gICAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7XG4gICAgICAgICAgICAgIHRoaXMuc3RhdHVzQmFySXRlbS5zZXRUZXh0KCdLYW5iYW4gU3RhdHVzIFVwZGF0ZXIgQWN0aXZlJyk7XG4gICAgICAgICAgfSwgNTAwMCk7XG4gICAgICAgICAgXG4gICAgICAgICAgdGhpcy5kZWJ1Z0xvZyhgU3VjY2VzczogJHt0aGlzLnNldHRpbmdzLnN0YXR1c1Byb3BlcnR5TmFtZX0gZm9yICR7ZmlsZS5iYXNlbmFtZX0gJHthY3Rpb259IGZyb20gXCIke29sZFN0YXR1c31cIiB0byBcIiR7bmV3U3RhdHVzfVwiYCk7XG4gICAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICAgIHRoaXMuZGVidWdMb2coYEVycm9yIHVwZGF0aW5nIG5vdGUgc3RhdHVzOiAke2Vycm9yLm1lc3NhZ2V9YCk7XG4gICAgICAgICAgbmV3IE5vdGljZShg4pqg77iPIEVycm9yIHVwZGF0aW5nICR7dGhpcy5zZXR0aW5ncy5zdGF0dXNQcm9wZXJ0eU5hbWV9IGZvciAke2ZpbGUuYmFzZW5hbWV9OiAke2Vycm9yLm1lc3NhZ2V9YCwgMTAwMDApO1xuICAgICAgfVxuICB9XG59XG5cbi8vIFNldHRpbmdzIFRhYlxuY2xhc3MgS2FuYmFuU3RhdHVzVXBkYXRlclNldHRpbmdUYWIgZXh0ZW5kcyBQbHVnaW5TZXR0aW5nVGFiIHtcbiAgcGx1Z2luOiBLYW5iYW5TdGF0dXNVcGRhdGVyUGx1Z2luO1xuXG4gIGNvbnN0cnVjdG9yKGFwcDogQXBwLCBwbHVnaW46IEthbmJhblN0YXR1c1VwZGF0ZXJQbHVnaW4pIHtcbiAgICAgIHN1cGVyKGFwcCwgcGx1Z2luKTtcbiAgICAgIHRoaXMucGx1Z2luID0gcGx1Z2luO1xuICB9XG5cbiAgZGlzcGxheSgpOiB2b2lkIHtcbiAgICAgIGNvbnN0IHtjb250YWluZXJFbH0gPSB0aGlzO1xuXG4gICAgICBjb250YWluZXJFbC5lbXB0eSgpO1xuICAgICAgY29udGFpbmVyRWwuY3JlYXRlRWwoJ2gyJywge3RleHQ6ICdLYW5iYW4gU3RhdHVzIFVwZGF0ZXIgU2V0dGluZ3MnfSk7XG5cbiAgICAgIG5ldyBTZXR0aW5nKGNvbnRhaW5lckVsKVxuICAgICAgICAgIC5zZXROYW1lKCdTdGF0dXMgUHJvcGVydHkgTmFtZScpXG4gICAgICAgICAgLnNldERlc2MoJ1RoZSBuYW1lIG9mIHRoZSBwcm9wZXJ0eSB0byB1cGRhdGUgd2hlbiBhIGNhcmQgaXMgbW92ZWQnKVxuICAgICAgICAgIC5hZGRUZXh0KHRleHQgPT4gdGV4dFxuICAgICAgICAgICAgICAuc2V0UGxhY2Vob2xkZXIoJ3N0YXR1cycpXG4gICAgICAgICAgICAgIC5zZXRWYWx1ZSh0aGlzLnBsdWdpbi5zZXR0aW5ncy5zdGF0dXNQcm9wZXJ0eU5hbWUpXG4gICAgICAgICAgICAgIC5vbkNoYW5nZShhc3luYyAodmFsdWUpID0+IHtcbiAgICAgICAgICAgICAgICAgIHRoaXMucGx1Z2luLnNldHRpbmdzLnN0YXR1c1Byb3BlcnR5TmFtZSA9IHZhbHVlO1xuICAgICAgICAgICAgICAgICAgYXdhaXQgdGhpcy5wbHVnaW4uc2F2ZVNldHRpbmdzKCk7XG4gICAgICAgICAgICAgIH0pKTtcblxuICAgICAgbmV3IFNldHRpbmcoY29udGFpbmVyRWwpXG4gICAgICAgICAgLnNldE5hbWUoJ1Nob3cgTm90aWZpY2F0aW9ucycpXG4gICAgICAgICAgLnNldERlc2MoJ1Nob3cgYSBub3RpZmljYXRpb24gd2hlbiBhIHN0YXR1cyBpcyB1cGRhdGVkJylcbiAgICAgICAgICAuYWRkVG9nZ2xlKHRvZ2dsZSA9PiB0b2dnbGVcbiAgICAgICAgICAgICAgLnNldFZhbHVlKHRoaXMucGx1Z2luLnNldHRpbmdzLnNob3dOb3RpZmljYXRpb25zKVxuICAgICAgICAgICAgICAub25DaGFuZ2UoYXN5bmMgKHZhbHVlKSA9PiB7XG4gICAgICAgICAgICAgICAgICB0aGlzLnBsdWdpbi5zZXR0aW5ncy5zaG93Tm90aWZpY2F0aW9ucyA9IHZhbHVlO1xuICAgICAgICAgICAgICAgICAgYXdhaXQgdGhpcy5wbHVnaW4uc2F2ZVNldHRpbmdzKCk7XG4gICAgICAgICAgICAgIH0pKTtcbiAgICAgICAgICAgICAgXG4gICAgICBuZXcgU2V0dGluZyhjb250YWluZXJFbClcbiAgICAgICAgICAuc2V0TmFtZSgnRGVidWcgTW9kZScpXG4gICAgICAgICAgLnNldERlc2MoJ0VuYWJsZSBkZXRhaWxlZCBsb2dnaW5nIHRvIGNvbnNvbGUgYW5kIHN0YXR1cyBiYXIgdXBkYXRlcycpXG4gICAgICAgICAgLmFkZFRvZ2dsZSh0b2dnbGUgPT4gdG9nZ2xlXG4gICAgICAgICAgICAgIC5zZXRWYWx1ZSh0aGlzLnBsdWdpbi5zZXR0aW5ncy5kZWJ1Z01vZGUpXG4gICAgICAgICAgICAgIC5vbkNoYW5nZShhc3luYyAodmFsdWUpID0+IHtcbiAgICAgICAgICAgICAgICAgIHRoaXMucGx1Z2luLnNldHRpbmdzLmRlYnVnTW9kZSA9IHZhbHVlO1xuICAgICAgICAgICAgICAgICAgYXdhaXQgdGhpcy5wbHVnaW4uc2F2ZVNldHRpbmdzKCk7XG4gICAgICAgICAgICAgICAgICBuZXcgTm90aWNlKGBEZWJ1ZyBtb2RlICR7dmFsdWUgPyAnZW5hYmxlZCcgOiAnZGlzYWJsZWQnfWApO1xuICAgICAgICAgICAgICB9KSk7XG4gICAgICAgICAgICAgIFxuICAgICAgLy8gQWRkIGEgYnV0dG9uIHRvIHRyaWdnZXIgYSB0ZXN0IHVwZGF0ZVxuICAgICAgbmV3IFNldHRpbmcoY29udGFpbmVyRWwpXG4gICAgICAgICAgLnNldE5hbWUoJ1Rlc3QgUGx1Z2luJylcbiAgICAgICAgICAuc2V0RGVzYygnUnVuIGEgdGVzdCB0byB2ZXJpZnkgcGx1Z2luIGZ1bmN0aW9uYWxpdHknKVxuICAgICAgICAgIC5hZGRCdXR0b24oYnV0dG9uID0+IGJ1dHRvblxuICAgICAgICAgICAgICAuc2V0QnV0dG9uVGV4dCgnUnVuIFRlc3QnKVxuICAgICAgICAgICAgICAub25DbGljaygoKSA9PiB7XG4gICAgICAgICAgICAgICAgICBuZXcgTm90aWNlKCdUZXN0IGZ1bmN0aW9uIHJ1bm5pbmcgLSBjaGVjayBjb25zb2xlIGZvciBsb2dzJyk7XG4gICAgICAgICAgICAgICAgICB0aGlzLnBsdWdpbi5kZWJ1Z0xvZygnVGVzdCBmdW5jdGlvbiB0cmlnZ2VyZWQgZnJvbSBzZXR0aW5ncycpO1xuICAgICAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgICAgICAvLyBTaG93IGFuIGV4YW1wbGUgb2Ygd2hhdCBhIHN1Y2Nlc3NmdWwgdXBkYXRlIHdvdWxkIGxvb2sgbGlrZVxuICAgICAgICAgICAgICAgICAgY29uc3QgYmFubmVyID0gY3JlYXRlRnJhZ21lbnQoZWwgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgIGVsLmNyZWF0ZURpdih7IFxuICAgICAgICAgICAgICAgICAgICAgICAgICB0ZXh0OiBg4pyFICR7dGhpcy5wbHVnaW4uc2V0dGluZ3Muc3RhdHVzUHJvcGVydHlOYW1lfSB1cGRhdGVkOmAsXG4gICAgICAgICAgICAgICAgICAgICAgICAgIGNsczogJ3N0YXR1cy11cGRhdGVkLWJhbm5lci10aXRsZSdcbiAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgICBlbC5jcmVhdGVEaXYoe1xuICAgICAgICAgICAgICAgICAgICAgICAgICBjbHM6ICdzdGF0dXMtdXBkYXRlZC1iYW5uZXItZGV0YWlscydcbiAgICAgICAgICAgICAgICAgICAgICB9LCBkaXYgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgICBkaXYuY3JlYXRlU3Bhbih7IHRleHQ6ICdGaWxlOiAnIH0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgICBkaXYuY3JlYXRlU3Bhbih7IFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGV4dDogJ0V4YW1wbGUgTm90ZScsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjbHM6ICdzdGF0dXMtdXBkYXRlZC1maWxlbmFtZSdcbiAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgIGRpdi5jcmVhdGVFbCgnYnInKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgZGl2LmNyZWF0ZVNwYW4oeyB0ZXh0OiAnQ2hhbmdlZCBmcm9tOiAnIH0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgICBkaXYuY3JlYXRlU3Bhbih7IFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGV4dDogJ1wiSW4gUHJvZ3Jlc3NcIicsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjbHM6ICdzdGF0dXMtdXBkYXRlZC1vbGQtdmFsdWUnXG4gICAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgICBkaXYuY3JlYXRlRWwoJ2JyJyk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgIGRpdi5jcmVhdGVTcGFuKHsgdGV4dDogJ05ldyB2YWx1ZTogJyB9KTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgZGl2LmNyZWF0ZVNwYW4oeyBcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRleHQ6ICdcIkNvbXBsZXRlZFwiJyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNsczogJ3N0YXR1cy11cGRhdGVkLW5ldy12YWx1ZSdcbiAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgICAgbmV3IE5vdGljZShiYW5uZXIsIDUwMDApO1xuICAgICAgICAgICAgICB9KSk7XG4gICAgICAgICAgICAgIFxuICAgICAgY29udGFpbmVyRWwuY3JlYXRlRWwoJ2gzJywge3RleHQ6ICdUcm91Ymxlc2hvb3RpbmcnfSk7XG4gICAgICBcbiAgICAgIGNvbnRhaW5lckVsLmNyZWF0ZUVsKCdwJywge1xuICAgICAgICAgIHRleHQ6ICdJZiB0aGUgcGx1Z2luIGlzIG5vdCB3b3JraW5nLCBjaGVjayB0aGUgZm9sbG93aW5nOidcbiAgICAgIH0pO1xuICAgICAgXG4gICAgICBjb25zdCB0cm91Ymxlc2hvb3RpbmdMaXN0ID0gY29udGFpbmVyRWwuY3JlYXRlRWwoJ3VsJyk7XG4gICAgICBcbiAgICAgIHRyb3VibGVzaG9vdGluZ0xpc3QuY3JlYXRlRWwoJ2xpJywge1xuICAgICAgICAgIHRleHQ6ICdFbnN1cmUgdGhlIEthbmJhbiBwbHVnaW4gaXMgaW5zdGFsbGVkIGFuZCBlbmFibGVkJ1xuICAgICAgfSk7XG4gICAgICBcbiAgICAgIHRyb3VibGVzaG9vdGluZ0xpc3QuY3JlYXRlRWwoJ2xpJywge1xuICAgICAgICAgIHRleHQ6ICdWZXJpZnkgeW91ciBLYW5iYW4gY2FyZHMgY29udGFpbiB3aWtpLWxpbmtzIChlLmcuLCBbW05vdGUgVGl0bGVdXSknXG4gICAgICB9KTtcbiAgICAgIFxuICAgICAgdHJvdWJsZXNob290aW5nTGlzdC5jcmVhdGVFbCgnbGknLCB7XG4gICAgICAgICAgdGV4dDogJ1RyeSBlbmFibGluZyBEZWJ1ZyBNb2RlIHRvIHNlZSBkZXRhaWxlZCBsb2dzIGluIHRoZSBkZXZlbG9wZXIgY29uc29sZSAoQ3RybCtTaGlmdCtJKSdcbiAgICAgIH0pO1xuICB9XG59XG4iXSwibmFtZXMiOlsiUGx1Z2luIiwiTm90aWNlIiwicGFyc2VZYW1sIiwic3RyaW5naWZ5WWFtbCIsIlBsdWdpblNldHRpbmdUYWIiLCJTZXR0aW5nIl0sIm1hcHBpbmdzIjoiOzs7O0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQW9HQTtBQUNPLFNBQVMsU0FBUyxDQUFDLE9BQU8sRUFBRSxVQUFVLEVBQUUsQ0FBQyxFQUFFLFNBQVMsRUFBRTtBQUM3RCxJQUFJLFNBQVMsS0FBSyxDQUFDLEtBQUssRUFBRSxFQUFFLE9BQU8sS0FBSyxZQUFZLENBQUMsR0FBRyxLQUFLLEdBQUcsSUFBSSxDQUFDLENBQUMsVUFBVSxPQUFPLEVBQUUsRUFBRSxPQUFPLENBQUMsS0FBSyxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsRUFBRTtBQUNoSCxJQUFJLE9BQU8sS0FBSyxDQUFDLEtBQUssQ0FBQyxHQUFHLE9BQU8sQ0FBQyxFQUFFLFVBQVUsT0FBTyxFQUFFLE1BQU0sRUFBRTtBQUMvRCxRQUFRLFNBQVMsU0FBUyxDQUFDLEtBQUssRUFBRSxFQUFFLElBQUksRUFBRSxJQUFJLENBQUMsU0FBUyxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxPQUFPLENBQUMsRUFBRSxFQUFFLE1BQU0sQ0FBQyxDQUFDLENBQUMsQ0FBQyxFQUFFLEVBQUU7QUFDbkcsUUFBUSxTQUFTLFFBQVEsQ0FBQyxLQUFLLEVBQUUsRUFBRSxJQUFJLEVBQUUsSUFBSSxDQUFDLFNBQVMsQ0FBQyxPQUFPLENBQUMsQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxPQUFPLENBQUMsRUFBRSxFQUFFLE1BQU0sQ0FBQyxDQUFDLENBQUMsQ0FBQyxFQUFFLEVBQUU7QUFDdEcsUUFBUSxTQUFTLElBQUksQ0FBQyxNQUFNLEVBQUUsRUFBRSxNQUFNLENBQUMsSUFBSSxHQUFHLE9BQU8sQ0FBQyxNQUFNLENBQUMsS0FBSyxDQUFDLEdBQUcsS0FBSyxDQUFDLE1BQU0sQ0FBQyxLQUFLLENBQUMsQ0FBQyxJQUFJLENBQUMsU0FBUyxFQUFFLFFBQVEsQ0FBQyxDQUFDLEVBQUU7QUFDdEgsUUFBUSxJQUFJLENBQUMsQ0FBQyxTQUFTLEdBQUcsU0FBUyxDQUFDLEtBQUssQ0FBQyxPQUFPLEVBQUUsVUFBVSxJQUFJLEVBQUUsQ0FBQyxFQUFFLElBQUksRUFBRSxDQUFDLENBQUM7QUFDOUUsS0FB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
